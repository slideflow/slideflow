


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>slideflow.studio &mdash; slideflow 3.0.0 documentation</title>















  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />




  <script src="../../../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../../../_static/fonts/IBMPlexSans/IBMPlexSans-Light.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexSans/IBMPlexSans-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexSans/IBMPlexSans-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexSans/IBMPlexSans-MediumItalic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
  <script defer data-domain="slideflow.dev" src="https://plausible.io/js/script.js"></script>
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://slideflow.dev" aria-label="Slideflow"></a>

      <div class="main-menu">
        <ul>
          <li class="active">
            <a href="https://slideflow.dev">Docs</a>
          </li>

          <li>
            <a href="https://slideflow.dev/tutorial1/">Tutorials</a>
          </li>

          <li>
            <a href="https://github.com/slideflow/slideflow">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">





    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">





                <div class="version">
                  3.0
                </div>









<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search/" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


          </div>







              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart/">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project_setup/">Setting up a Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../datasets_and_val/">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../slide_processing/">Slide Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../training/">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../evaluation/">Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../posthoc/">Layer Activations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../uq/">Uncertainty Quantification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features/">Generating Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mil/">Multiple-Instance Learning (MIL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ssl/">Self-Supervised Learning (SSL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../stylegan/">Generative Networks (GANs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../saliency/">Saliency Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../segmentation/">Tissue Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cellseg/">Cell Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../custom_loops/">Custom Training Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../studio/">Slideflow Studio: Live Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting/">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tfrecords/">TFRecords: Reading and Writing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dataloaders/">Dataloaders: Sampling and Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../custom_extractors/">Custom Feature Extractors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tile_labels/">Strong Supervision with Tile Labels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plugins/">Creating a Slideflow Plugin</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../slideflow/">slideflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project/">slideflow.Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dataset/">slideflow.Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dataset_features/">slideflow.DatasetFeatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../heatmap/">slideflow.Heatmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model_params/">slideflow.ModelParams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mosaic/">slideflow.Mosaic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../slidemap/">slideflow.SlideMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../biscuit/">slideflow.biscuit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../slideflow_cellseg/">slideflow.cellseg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io/">slideflow.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io_tensorflow/">slideflow.io.tensorflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io_torch/">slideflow.io.torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gan/">slideflow.gan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../grad/">slideflow.grad</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mil_module/">slideflow.mil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model/">slideflow.model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model_tensorflow/">slideflow.model.tensorflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model_torch/">slideflow.model.torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../norm/">slideflow.norm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../simclr/">slideflow.simclr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../slide/">slideflow.slide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../slide_qc/">slideflow.slide.qc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../stats/">slideflow.stats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../util/">slideflow.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../studio_module/">slideflow.studio</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial1/">Tutorial 1: Model training (simple)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial2/">Tutorial 2: Model training (advanced)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial3/">Tutorial 3: Using a custom architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial4/">Tutorial 4: Model evaluation &amp; heatmaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial5/">Tutorial 5: Creating a mosaic map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial6/">Tutorial 6: Custom slide filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial7/">Tutorial 7: Training with custom augmentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial8/">Tutorial 8: Multiple-Instance Learning</a></li>
</ul>



        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">

      <li>
        <a href="../../../">

            Docs

        </a> &gt;
      </li>


          <li><a href="../../">Module code</a> &gt;</li>

      <li>slideflow.studio</li>


      <li class="pytorch-breadcrumbs-aside">

      </li>

  </ul>


</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">



          <div class="rst-content">

            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">

  <h1>Source code for slideflow.studio</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">webbrowser</span>
<span class="kn">import</span> <span class="nn">pyperclip</span>
<span class="kn">import</span> <span class="nn">imgui</span>
<span class="kn">import</span> <span class="nn">glfw</span>
<span class="kn">import</span> <span class="nn">OpenGL.GL</span> <span class="k">as</span> <span class="nn">gl</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">abspath</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">Tk</span>
<span class="kn">from</span> <span class="nn">tkinter.filedialog</span> <span class="kn">import</span> <span class="n">askopenfilename</span><span class="p">,</span> <span class="n">askdirectory</span>

<span class="kn">import</span> <span class="nn">slideflow</span> <span class="k">as</span> <span class="nn">sf</span>
<span class="kn">from</span> <span class="nn">slideflow</span> <span class="kn">import</span> <span class="n">log</span>

<span class="kn">from</span> <span class="nn">.gui</span> <span class="kn">import</span> <span class="n">imgui_utils</span>
<span class="kn">from</span> <span class="nn">.gui</span> <span class="kn">import</span> <span class="n">gl_utils</span>
<span class="kn">from</span> <span class="nn">.gui</span> <span class="kn">import</span> <span class="n">text_utils</span>
<span class="kn">from</span> <span class="nn">.gui.theme</span> <span class="kn">import</span> <span class="n">StudioTheme</span>
<span class="kn">from</span> <span class="nn">.gui.window</span> <span class="kn">import</span> <span class="n">ImguiWindow</span>
<span class="kn">from</span> <span class="nn">.gui.viewer</span> <span class="kn">import</span> <span class="n">SlideViewer</span>
<span class="kn">from</span> <span class="nn">.widgets</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ProjectWidget</span><span class="p">,</span> <span class="n">SlideWidget</span><span class="p">,</span> <span class="n">ModelWidget</span><span class="p">,</span> <span class="n">HeatmapWidget</span><span class="p">,</span> <span class="n">PerformanceWidget</span><span class="p">,</span>
    <span class="n">CaptureWidget</span><span class="p">,</span> <span class="n">SettingsWidget</span><span class="p">,</span> <span class="n">ExtensionsWidget</span><span class="p">,</span> <span class="n">Widget</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">EasyDict</span><span class="p">,</span> <span class="n">prediction_to_string</span><span class="p">,</span> <span class="n">StatusMessage</span>
<span class="kn">from</span> <span class="nn">._renderer</span> <span class="kn">import</span> <span class="n">Renderer</span>
<span class="kn">from</span> <span class="nn">._render_manager</span> <span class="kn">import</span> <span class="n">AsyncRenderManager</span><span class="p">,</span> <span class="n">Renderer</span><span class="p">,</span> <span class="n">CapturedException</span>

<span class="n">OVERLAY_GRID</span>    <span class="o">=</span> <span class="mi">0</span>
<span class="n">OVERLAY_WSI</span>     <span class="o">=</span> <span class="mi">1</span>
<span class="n">OVERLAY_VIEW</span>    <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Studio"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio">[docs]</a><span class="k">class</span> <span class="nc">Studio</span><span class="p">(</span><span class="n">ImguiWindow</span><span class="p">):</span>

<div class="viewcode-block" id="Studio.__init__"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">low_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">widgets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">skip_tk_init</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">theme</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StudioTheme</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the main Studio window.</span>

<span class="sd">        Slideflow Studio is started by running the studio module.</span>

<span class="sd">        .. code-block:: bash</span>

<span class="sd">            python -m slideflow.studio</span>

<span class="sd">        Args:</span>
<span class="sd">            low_memory (bool): Enable low memory mode, which uses thread pools</span>
<span class="sd">                instead of multiprocessing pools when applicable to reduce</span>
<span class="sd">                memory footprint, at the cost of decreased performance.</span>
<span class="sd">            widgets (list(Any), optional): Additional widgets to render.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Initialize TK window in background (for file dialogs)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_tk_init</span><span class="p">:</span>
            <span class="n">Tk</span><span class="p">()</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">theme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">theme</span> <span class="o">=</span> <span class="n">StudioTheme</span><span class="p">()</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Slideflow Studio&#39;</span><span class="p">,</span>
            <span class="n">background</span><span class="o">=</span><span class="n">theme</span><span class="o">.</span><span class="n">main_background</span>
        <span class="p">)</span>

        <span class="c1"># Internals.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dx</span>                <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dy</span>                <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_error_print</span>  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span>    <span class="o">=</span> <span class="n">AsyncRenderManager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addl_renderers</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defer_rendering</span>   <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tex_img</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tex_obj</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_img</span>      <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_obj</span>      <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_img</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_obj</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_obj</span>       <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_img</span>       <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_about_tex_obj</span>     <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span>       <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_path</span>        <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span>      <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normalizer</span>        <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_wsi</span>     <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span>       <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content_width</span>     <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content_height</span>    <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pane_w</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_view</span>      <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overlay_wsi_dim</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overlay_offset_wsi_dim</span>   <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thumb_params</span>      <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_model</span>         <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_uncertainty</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_saliency</span>      <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_model_img_fmt</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tex_to_delete</span>     <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defer_tile_refresh</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_should_close_slide</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_should_close_model</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bg_logo</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_message</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pred_message</span>      <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low_memory</span>         <span class="o">=</span> <span class="n">low_memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suspend_mouse_input</span>       <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suspend_keyboard_input</span>    <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_message</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_enable_tile_preview</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Interface.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_about</span>                <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_tile_preview</span>         <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_preview_is_new</span>       <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_preview_image_is_new</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_overlays</span>             <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_mpp_zoom_popup</span>       <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_mpp</span>                 <span class="o">=</span> <span class="mf">1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box_color</span>                 <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theme</span>                      <span class="o">=</span> <span class="n">theme</span>

        <span class="c1"># Widget interface.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span>                <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsi_thumb</span>          <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span>             <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saliency</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_x</span>              <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_y</span>              <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_px</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_um</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_zoom</span>          <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rendered_heatmap</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlay</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlay_original</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rendered_qc</span>        <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlay_qc</span>         <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span>               <span class="o">=</span> <span class="n">EasyDict</span><span class="p">(</span><span class="n">use_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_uncertainty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_saliency</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span>             <span class="o">=</span> <span class="n">EasyDict</span><span class="p">(</span><span class="n">predictions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pane_w</span>             <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_w</span>            <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_w</span>           <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span>                  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span>                  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_x</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_y</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mouse_screen_x</span>    <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mouse_screen_y</span>    <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_bar_height</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span>

        <span class="c1"># Control sidebar.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span>            <span class="o">=</span> <span class="n">Sidebar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Core widgets.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_widget</span>     <span class="o">=</span> <span class="n">ProjectWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slide_widget</span>       <span class="o">=</span> <span class="n">SlideWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_widget</span>       <span class="o">=</span> <span class="n">ModelWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_widget</span>     <span class="o">=</span> <span class="n">HeatmapWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">performance_widget</span> <span class="o">=</span> <span class="n">PerformanceWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capture_widget</span>     <span class="o">=</span> <span class="n">CaptureWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings_widget</span>    <span class="o">=</span> <span class="n">SettingsWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># User-defined widgets.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">widgets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">widgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_widgets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_widgets</span><span class="p">(</span><span class="n">widgets</span><span class="p">)</span>

        <span class="c1"># Extensions widget.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extensions_widget</span>  <span class="o">=</span> <span class="n">ExtensionsWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Initialize window.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_window_icon</span><span class="p">(</span><span class="n">imgui_utils</span><span class="o">.</span><span class="n">logo_image</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_window_limits</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_default_font_size</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_frame</span><span class="p">()</span> <span class="c1"># Layout may change after first frame.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_slide</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">show_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;An overlay (e.g. tile filter or heatmap) is currently being shown</span>
<span class="sd">        over the main view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_widget</span><span class="o">.</span><span class="n">show_overlay</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_widget</span><span class="o">.</span><span class="n">show</span><span class="p">)</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_overlays</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tensorflow/PyTorch model currently in use.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">_model</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">P</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Slideflow project currently in use.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_widget</span><span class="o">.</span><span class="n">P</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">offset_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main window offset (x), in points.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pane_w</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">offset_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main window offset (y), in points.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_bar_height</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">offset_x_pixels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main window offset (x), in pixels.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ratio</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">offset_y_pixels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main window offset (y), in pixels.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ratio</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status_bar_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mouse_is_over_viewer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mouse is currently over the main viewer.&quot;&quot;&quot;</span>
        <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">imgui</span><span class="o">.</span><span class="n">get_mouse_pos</span><span class="p">()</span>
        <span class="n">cx</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_x</span>
        <span class="n">cy</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_y</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">is_in_view</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tile_preview_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show a tile preview when right clicking.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_path</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_force_enable_tile_preview</span>

    <span class="c1"># --- Internals -----------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_set_default_font_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change the interface font size.&quot;&quot;&quot;</span>
        <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_font_size</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">18</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ratio</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">!=</span> <span class="n">old</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skip_frame</span><span class="p">()</span>  <span class="c1"># Layout changed.</span>

    <span class="k">def</span> <span class="nf">_clear_textures</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove all textures.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">tex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tex_to_delete</span><span class="p">:</span>
            <span class="n">tex</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tex_to_delete</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_close_model_now</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the currently loaded model now.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">clear_result</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_model</span>         <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_uncertainty</span>   <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_saliency</span>      <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_path</span>        <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span>      <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normalizer</span>        <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_px</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_um</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span>            <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span>                  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span>                  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">clear_model</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_model_results</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_widget</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_close_slide_now</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the currently loaded slide now.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wsi_thumb</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_result</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">_live_updates</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_img</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_obj</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_widget</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Slideflow Studio&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_about_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the About dialog.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_about</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">platform</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">pyvips</span>
                <span class="kn">from</span> <span class="nn">pyvips.base</span> <span class="kn">import</span> <span class="n">version</span> <span class="k">as</span> <span class="n">lv</span>
                <span class="n">libvips_version</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">lv</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">lv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">lv</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">pyvips_version</span> <span class="o">=</span> <span class="n">pyvips</span><span class="o">.</span><span class="n">__version__</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">libvips_version</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
                <span class="n">pyvips_version</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>

            <span class="n">imgui</span><span class="o">.</span><span class="n">open_popup</span><span class="p">(</span><span class="s1">&#39;about_popup&#39;</span><span class="p">)</span>
            <span class="n">version_width</span> <span class="o">=</span> <span class="n">imgui</span><span class="o">.</span><span class="n">calc_text_size</span><span class="p">(</span><span class="s2">&quot;Version: &quot;</span> <span class="o">+</span> <span class="n">sf</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">version_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span>
            <span class="n">height</span> <span class="o">=</span> <span class="mi">315</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_content_size</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">about_text</span> <span class="o">=</span>  <span class="sa">f</span><span class="s2">&quot;Version: </span><span class="si">{</span><span class="n">sf</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">about_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Python: </span><span class="si">{</span><span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">about_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Slide Backend: </span><span class="si">{</span><span class="n">sf</span><span class="o">.</span><span class="n">slide_backend</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">about_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Libvips: </span><span class="si">{</span><span class="n">libvips_version</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">about_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Pyvips: </span><span class="si">{</span><span class="n">pyvips_version</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">about_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;OS: </span><span class="si">{</span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">platform</span><span class="o">.</span><span class="n">release</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">begin_popup</span><span class="p">(</span><span class="s1">&#39;about_popup&#39;</span><span class="p">):</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_about_tex_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">about_img</span> <span class="o">=</span> <span class="n">imgui_utils</span><span class="o">.</span><span class="n">logo_image</span><span class="p">()</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">96</span><span class="p">,</span> <span class="mi">96</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_about_tex_obj</span> <span class="o">=</span> <span class="n">gl_utils</span><span class="o">.</span><span class="n">Texture</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">about_img</span><span class="p">)</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">same_line</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">get_content_region_max</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">48</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_about_tex_obj</span><span class="o">.</span><span class="n">gl_id</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">96</span><span class="p">)</span>

                <span class="n">imgui</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bold_font</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">center_text</span><span class="p">(</span><span class="s1">&#39;Slideflow Studio&#39;</span><span class="p">)</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">about_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">center_text</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">same_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">imgui_utils</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Copy&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">button_w</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">pyperclip</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">about_text</span><span class="p">)</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">same_line</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">get_content_region_max</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">button_w</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">imgui_utils</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Close&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">button_w</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_show_about</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">end_popup</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_draw_mpp_zoom_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show a dialog that prompts the user to specify microns-per-pixel.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_mpp_zoom_popup</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">window_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mi">18</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_next_window</span><span class="p">(</span><span class="o">*</span><span class="n">window_size</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_size</span><span class="p">(</span><span class="o">*</span><span class="n">window_size</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">opened</span> <span class="o">=</span> <span class="n">imgui</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="s1">&#39;Zoom to Microns-Per-Pixel (MPP)&#39;</span><span class="p">,</span> <span class="n">closable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_RESIZE</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opened</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_mpp_zoom_popup</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">imgui</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;Zoom the current view to a given MPP.&quot;</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">same_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">imgui_utils</span><span class="o">.</span><span class="n">item_width</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="o">*</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">_changed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_mpp</span> <span class="o">=</span> <span class="n">imgui</span><span class="o">.</span><span class="n">input_float</span><span class="p">(</span><span class="s1">&#39;MPP##input_mpp&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_mpp</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">same_line</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_mpp</span><span class="p">:</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">10</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_mpp</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">x&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">full_button</span><span class="p">(</span><span class="s2">&quot;Zoom&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">zoom_to_mpp</span><span class="p">(</span><span class="n">window_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">window_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_mpp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_mpp_zoom_popup</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_draw_control_pane</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the control pane and widgets.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_draw_empty_background</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render an empty background with the Studio logo.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bg_logo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bg_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;gui&#39;</span><span class="p">,</span> <span class="s1">&#39;logo_dark_outline.png&#39;</span><span class="p">)</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">bg_path</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bg_logo</span> <span class="o">=</span> <span class="n">gl_utils</span><span class="o">.</span><span class="n">Texture</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">bilinear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bg_logo</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span>
            <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content_frame_width</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_frame_height</span><span class="o">//</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">zoom</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
            <span class="n">align</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">rint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="s1">&#39;center&#39;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_main_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="n">EasyDict</span><span class="p">,</span> <span class="n">window_changed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the main window view.</span>

<span class="sd">        Draws the slide / picam view, overlay heatmap, overlay box, and ROIs.</span>

<span class="sd">        Args:</span>
<span class="sd">            inp (EasyDict): Dictionary of user input.</span>
<span class="sd">            window_changed (bool): Window size has changed (force refresh).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">max_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_frame_width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_x_pixels</span>
        <span class="n">max_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_frame_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_y_pixels</span>

        <span class="c1"># Update the viewer in response to user input.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">movable</span><span class="p">:</span>
            <span class="c1"># Update WSI focus location &amp; zoom values</span>
            <span class="c1"># If shift-dragging or scrolling.</span>
            <span class="n">dz</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inp</span><span class="o">.</span><span class="n">dragging</span><span class="p">:</span>
                <span class="n">inp</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">inp</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">inp</span><span class="o">.</span><span class="n">wheel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dz</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">1.5</span>
            <span class="k">if</span> <span class="n">inp</span><span class="o">.</span><span class="n">wheel</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dz</span> <span class="o">=</span> <span class="mf">1.5</span>
            <span class="k">if</span> <span class="n">inp</span><span class="o">.</span><span class="n">wheel</span> <span class="ow">or</span> <span class="n">inp</span><span class="o">.</span><span class="n">dragging</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_view</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inp</span><span class="o">.</span><span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">inp</span><span class="o">.</span><span class="n">dy</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inp</span><span class="o">.</span><span class="n">wheel</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span> <span class="n">inp</span><span class="o">.</span><span class="n">cy</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_view</span> <span class="ow">and</span> <span class="n">inp</span><span class="o">.</span><span class="n">dx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inp</span><span class="o">.</span><span class="n">wheel</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">refresh_view</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_view</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">display_coords_to_wsi_coords</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span> <span class="n">inp</span><span class="o">.</span><span class="n">cy</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Render slide view.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">max_w</span><span class="p">,</span> <span class="n">max_h</span><span class="p">)</span>

        <span class="c1"># Render overlay heatmap.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_overlay</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">render_overlay</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">overlay</span><span class="p">,</span>
                <span class="n">dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_overlay_wsi_dim</span><span class="p">,</span>
                <span class="n">offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_overlay_offset_wsi_dim</span><span class="p">)</span>

        <span class="c1"># Render overlay tooltip, if hovered.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlay_original</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_overlay</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">render_overlay_tooltip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlay_original</span><span class="p">)</span>

        <span class="c1"># Calculate location for model display.</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_preview_enabled</span>
            <span class="ow">and</span> <span class="n">inp</span><span class="o">.</span><span class="n">clicking</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">inp</span><span class="o">.</span><span class="n">dragging</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">is_in_view</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span> <span class="n">inp</span><span class="o">.</span><span class="n">cy</span><span class="p">)):</span>

            <span class="n">wsi_x</span><span class="p">,</span> <span class="n">wsi_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">display_coords_to_wsi_coords</span><span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span> <span class="n">inp</span><span class="o">.</span><span class="n">cy</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">wsi_x</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">full_extract_px</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">wsi_y</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">full_extract_px</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Show box around location that a tile is being extracted for preview.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inp</span><span class="o">.</span><span class="n">clicking</span> <span class="ow">or</span> <span class="n">inp</span><span class="o">.</span><span class="n">dragging</span> <span class="ow">or</span> <span class="n">inp</span><span class="o">.</span><span class="n">wheel</span> <span class="ow">or</span> <span class="n">window_changed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">box_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">wsi_coords_to_display_coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">tw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">full_extract_px</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">view_zoom</span>

            <span class="c1"># Draw box on main display.</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">glPolygonMode</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">GL_LINE</span><span class="p">)</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">glLineWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">box_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">box_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_y</span><span class="p">])</span>
            <span class="n">gl_utils</span><span class="o">.</span><span class="n">draw_rect</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">box_pos</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tw</span><span class="p">,</span> <span class="n">tw</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_box_color</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">gl</span><span class="o">.</span><span class="n">GL_LINE_LOOP</span><span class="p">)</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">glPolygonMode</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">GL_FILL</span><span class="p">)</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">glLineWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Render ROIs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">late_render</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_draw_menu_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the main menu bar (File, View, Help)&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">begin_main_menu_bar</span><span class="p">():</span>
            <span class="c1"># --- File --------------------------------------------------------</span>
            <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">begin_menu</span><span class="p">(</span><span class="s1">&#39;File&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;New Project...&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+N&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_widget</span><span class="o">.</span><span class="n">new_project</span><span class="p">()</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Open Project...&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+P&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ask_load_project</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Open Slide...&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+O&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ask_load_slide</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Load Model...&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+M&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ask_load_model</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Load Heatmap...&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+H&#39;</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ask_load_heatmap</span><span class="p">()</span>

                <span class="c1"># Widgets with &quot;Open&quot; menu options.</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s1">&#39;open_menu_options&#39;</span><span class="p">):</span>
                        <span class="n">w</span><span class="o">.</span><span class="n">open_menu_options</span><span class="p">()</span>

                <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">begin_menu</span><span class="p">(</span><span class="s1">&#39;Export...&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Main view&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">capture_widget</span><span class="o">.</span><span class="n">save_view</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Tile view&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">capture_widget</span><span class="o">.</span><span class="n">save_tile</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;GUI view&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">capture_widget</span><span class="o">.</span><span class="n">save_gui</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Heatmap (PNG)&#39;</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rendered_heatmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">h_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rendered_heatmap</span><span class="p">)</span>
                        <span class="n">h_img</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">h_img</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">NEAREST</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span><span class="o">.</span><span class="n">slide</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create_toast</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved heatmap image to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span><span class="o">.</span><span class="n">slide</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Heatmap (NPZ)&#39;</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span><span class="o">.</span><span class="n">save_npz</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create_toast</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved heatmap .npz to </span><span class="si">{</span><span class="n">loc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">)</span>
                    <span class="n">imgui</span><span class="o">.</span><span class="n">end_menu</span><span class="p">()</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Close Slide&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">close_slide</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Close Model&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">close_model</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Widgets with &quot;File&quot; menu.</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s1">&#39;file_menu_options&#39;</span><span class="p">):</span>
                        <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                        <span class="n">w</span><span class="o">.</span><span class="n">file_menu_options</span><span class="p">()</span>

                <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Exit&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+Q&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_exit_trigger</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">end_menu</span><span class="p">()</span>

            <span class="c1"># --- View --------------------------------------------------------</span>
            <span class="n">has_wsi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">,</span> <span class="n">SlideViewer</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">begin_menu</span><span class="p">(</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Fullscreen&#39;</span><span class="p">,</span> <span class="s1">&#39;Alt+Enter&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">toggle_fullscreen</span><span class="p">()</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>

                <span class="c1"># --- Show sub-menu -------------------------------------------</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">begin_menu</span><span class="p">(</span><span class="s1">&#39;Show&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Tile Preview&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+Shift+T&#39;</span><span class="p">,</span> <span class="n">selected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_show_tile_preview</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_show_tile_preview</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_tile_preview</span>
                    <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Thumbnail&#39;</span><span class="p">,</span> <span class="n">selected</span><span class="o">=</span><span class="p">(</span><span class="n">has_wsi</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">show_thumbnail</span><span class="p">),</span> <span class="n">enabled</span><span class="o">=</span><span class="n">has_wsi</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">show_thumbnail</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">show_thumbnail</span>
                    <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">,</span> <span class="n">selected</span><span class="o">=</span><span class="p">(</span><span class="n">has_wsi</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">show_scale</span><span class="p">),</span> <span class="n">enabled</span><span class="o">=</span><span class="n">has_wsi</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">show_scale</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">show_scale</span>

                    <span class="c1"># Widgets with &quot;View&quot; menu.</span>
                    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s1">&#39;show_menu_options&#39;</span><span class="p">):</span>
                            <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                            <span class="n">w</span><span class="o">.</span><span class="n">show_menu_options</span><span class="p">()</span>

                    <span class="n">imgui</span><span class="o">.</span><span class="n">end_menu</span><span class="p">()</span>
                <span class="c1"># -------------------------------------------------------------</span>

                <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Increase Font Size&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">increase_font_size</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Decrease Font Size&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">decrease_font_size</span><span class="p">()</span>

                <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Increase Tile Zoom&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+]&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">increase_tile_zoom</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Decrease Tile Zoom&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+[&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">decrease_tile_zoom</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Zoom to MPP&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ask_zoom_to_mpp</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Reset Tile Zoom&#39;</span><span class="p">,</span> <span class="s1">&#39;Ctrl+</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reset_tile_zoom</span><span class="p">()</span>

                <span class="c1"># Widgets with &quot;View&quot; menu.</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s1">&#39;view_menu_options&#39;</span><span class="p">):</span>
                        <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                        <span class="n">w</span><span class="o">.</span><span class="n">view_menu_options</span><span class="p">()</span>

                <span class="n">imgui</span><span class="o">.</span><span class="n">end_menu</span><span class="p">()</span>

            <span class="c1"># --- Help --------------------------------------------------------</span>
            <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">begin_menu</span><span class="p">(</span><span class="s1">&#39;Help&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Get Started&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;https://slideflow.dev/studio&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Documentation&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;https://slideflow.dev&#39;</span><span class="p">)</span>

                <span class="c1"># Widgets with &quot;Help&quot; menu.</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s1">&#39;help_menu_options&#39;</span><span class="p">):</span>
                        <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                        <span class="n">w</span><span class="o">.</span><span class="n">help_menu_options</span><span class="p">()</span>

                <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Release Notes&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">__github__</span><span class="p">,</span> <span class="s1">&#39;releases/tag&#39;</span><span class="p">,</span> <span class="n">sf</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;Report Issue&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">__github__</span><span class="p">,</span> <span class="s1">&#39;issues&#39;</span><span class="p">))</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">separator</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;View License&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">__github__</span><span class="p">,</span> <span class="s1">&#39;blob/master/LICENSE&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">menu_item</span><span class="p">(</span><span class="s1">&#39;About&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_show_about</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">end_menu</span><span class="p">()</span>

            <span class="n">version_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;slideflow </span><span class="si">{</span><span class="n">sf</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">imgui_utils</span><span class="o">.</span><span class="n">right_aligned_text</span><span class="p">(</span><span class="n">version_text</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">end_main_menu_bar</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_draw_status_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the bottom status bar.&quot;&quot;&quot;</span>

        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_bar_height</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ratio</span>
        <span class="n">y_pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content_frame_height</span> <span class="o">-</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">r</span><span class="p">))</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_position</span><span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content_width</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_WINDOW_BACKGROUND</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">main_background</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_var</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">STYLE_WINDOW_PADDING</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

        <span class="n">imgui</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="s1">&#39;Status bar&#39;</span><span class="p">,</span> <span class="n">closable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_RESIZE</span>
                                                        <span class="o">|</span> <span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_COLLAPSE</span>
                                                        <span class="o">|</span> <span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_TITLE_BAR</span>
                                                        <span class="o">|</span> <span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_MOVE</span>
                                                        <span class="o">|</span> <span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_SCROLLBAR</span><span class="p">))</span>

        <span class="c1"># Backend</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">slide_backend</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;cucim&#39;</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;small_cucim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gl_id</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">)</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">same_line</span><span class="p">()</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">text_colored</span><span class="p">(</span><span class="s1">&#39;cuCIM&#39;</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;libvips&#39;</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;small_vips&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gl_id</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">)</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">same_line</span><span class="p">()</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">text_colored</span><span class="p">(</span><span class="s1">&#39;VIPS&#39;</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">is_item_hovered</span><span class="p">():</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">set_tooltip</span><span class="p">(</span><span class="s2">&quot;Slide backend&quot;</span><span class="p">)</span>

        <span class="c1"># Low memory mode</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_memory</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;small_lowmem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gl_id</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">same_line</span><span class="p">()</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">)</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">same_line</span><span class="p">()</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">text_colored</span><span class="p">(</span><span class="s2">&quot;Low memory mode&quot;</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Status messages</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status_message</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>

        <span class="c1"># Location / MPP</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">,</span> <span class="s1">&#39;mpp&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">imgui_utils</span><span class="o">.</span><span class="n">right_aligned_text</span><span class="p">(</span><span class="s1">&#39;x=</span><span class="si">{:&lt;8}</span><span class="s1"> y=</span><span class="si">{:&lt;8}</span><span class="s1"> mpp=</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mouse_x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mouse_y</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">mpp</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">imgui_utils</span><span class="o">.</span><span class="n">right_aligned_text</span><span class="p">(</span>
                <span class="s1">&#39;x=</span><span class="si">{:&lt;8}</span><span class="s1"> y=</span><span class="si">{:&lt;8}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mouse_x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mouse_y</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="n">imgui</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">pop_style_color</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">pop_style_var</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_tile_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the tile view window, displaying the currently rendered tile(s).</span>

<span class="sd">        This window will show images rendered by a whole-slide viewer (image</span>
<span class="sd">        tile extracted at some x/y location from the slide), or potentially an</span>
<span class="sd">        image rendered via some other rendering mechanism as determined through</span>
<span class="sd">        renderes set via ``.add_to_render_pipeline()``. For example, images</span>
<span class="sd">        rendered by StyleGAN will be shown in this view. This view also shows</span>
<span class="sd">        a post-processed, post-normalized rendered image, if available.</span>

<span class="sd">        Rendered images are expected to be stored in the OpenGL objects</span>
<span class="sd">        ``.tex_obj`` and ``._norm_tex_obj``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_tile_preview</span><span class="p">:</span>
            <span class="n">has_raw_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tex_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">has_norm_image</span> <span class="o">=</span> <span class="s1">&#39;normalized&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># self.model_widget.use_model and self._normalizer is not None and self._norm_tex_obj is not None and self.tile_px</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_raw_image</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">has_raw_image</span> <span class="ow">or</span> <span class="n">has_norm_image</span><span class="p">):</span>
                <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mi">8</span>
                <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">raw_img_w</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">has_raw_image</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tex_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_zoom</span>
                <span class="n">norm_img_w</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">has_norm_image</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_zoom</span>
                <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">raw_img_w</span><span class="p">,</span> <span class="n">norm_img_w</span><span class="p">)</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">raw_img_w</span> <span class="o">+</span> <span class="n">norm_img_w</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="o">*</span><span class="mi">2</span>

            <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_size</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_preview_is_new</span><span class="p">:</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_position</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">content_width</span> <span class="o">-</span> <span class="n">width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">content_height</span> <span class="o">-</span> <span class="n">height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_bar_height</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tile_preview_is_new</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_preview_image_is_new</span> <span class="ow">and</span> <span class="p">(</span><span class="n">has_raw_image</span> <span class="ow">or</span> <span class="n">has_norm_image</span><span class="p">):</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_position</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">content_width</span> <span class="o">-</span> <span class="n">width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">content_height</span> <span class="o">-</span> <span class="n">height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_bar_height</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tile_preview_image_is_new</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_tile_preview</span> <span class="o">=</span> <span class="n">imgui</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span>
                <span class="s2">&quot;##tile view&quot;</span><span class="p">,</span>
                <span class="n">closable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_COLLAPSE</span>
                       <span class="o">|</span> <span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_RESIZE</span>
                       <span class="o">|</span> <span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_SCROLLBAR</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Image preview ===================================================</span>
            <span class="n">dim_color</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">get_style</span><span class="p">()</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_TEXT</span><span class="p">])</span>
            <span class="n">dim_color</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.5</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">begin_child</span><span class="p">(</span><span class="s1">&#39;##pred_image&#39;</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tex_obj</span><span class="o">.</span><span class="n">gl_id</span><span class="p">,</span> <span class="n">raw_img_w</span><span class="p">,</span> <span class="n">raw_img_w</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">is_item_hovered</span><span class="p">():</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">set_tooltip</span><span class="p">(</span><span class="s2">&quot;Raw image&quot;</span><span class="p">)</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">same_line</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">has_norm_image</span><span class="p">:</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_obj</span><span class="o">.</span><span class="n">gl_id</span><span class="p">,</span> <span class="n">norm_img_w</span><span class="p">,</span> <span class="n">norm_img_w</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">is_item_hovered</span><span class="p">():</span>
                    <span class="n">imgui</span><span class="o">.</span><span class="n">set_tooltip</span><span class="p">(</span><span class="s2">&quot;Stain-normalized image&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tex_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_px</span><span class="p">:</span>
                <span class="n">imgui</span><span class="o">.</span><span class="n">text_colored</span><span class="p">(</span><span class="s1">&#39;Normalizer not used&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">dim_color</span><span class="p">)</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">end_child</span><span class="p">()</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">same_line</span><span class="p">()</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_glfw_key_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_window</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_scancode</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">_mods</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback for handling keyboard input.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_glfw_key_callback</span><span class="p">(</span><span class="n">_window</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_scancode</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">_mods</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suspend_keyboard_input</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_N</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_widget</span><span class="o">.</span><span class="n">new_project</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_T</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_tile_preview</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_tile_preview</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_Q</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exit_trigger</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_O</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ask_load_slide</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_P</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ask_load_project</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_M</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ask_load_model</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_H</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ask_load_heatmap</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_SPACE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_widget</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">RELEASE</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_SPACE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_widget</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_LEFT_BRACKET</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decrease_tile_zoom</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_RIGHT_BRACKET</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">increase_tile_zoom</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_SLASH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ask_zoom_to_mpp</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_down</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_BACKSLASH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_tile_zoom</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">slide_widget</span><span class="o">.</span><span class="n">keyboard_callback</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_widget</span><span class="o">.</span><span class="n">keyboard_callback</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="s1">&#39;keyboard_callback&#39;</span><span class="p">):</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">keyboard_callback</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>

<div class="viewcode-block" id="Studio.suspend_mouse_input_handling"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.suspend_mouse_input_handling">[docs]</a>    <span class="k">def</span> <span class="nf">suspend_mouse_input_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Suspend mouse input handling.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suspend_mouse_input</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Studio.resume_mouse_input_handling"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.resume_mouse_input_handling">[docs]</a>    <span class="k">def</span> <span class="nf">resume_mouse_input_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resume mouse input handling.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suspend_mouse_input</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Studio.suspend_keyboard_input"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.suspend_keyboard_input">[docs]</a>    <span class="k">def</span> <span class="nf">suspend_keyboard_input</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Suspend keyboard input handling.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suspend_keyboard_input</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Studio.resume_keyboard_input"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.resume_keyboard_input">[docs]</a>    <span class="k">def</span> <span class="nf">resume_keyboard_input</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resume keyboard input handling.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suspend_keyboard_input</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Studio.mouse_input_is_suspended"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.mouse_input_is_suspended">[docs]</a>    <span class="k">def</span> <span class="nf">mouse_input_is_suspended</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if mouse input handling is suspended.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suspend_mouse_input</span></div>

<div class="viewcode-block" id="Studio.is_mouse_down"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.is_mouse_down">[docs]</a>    <span class="k">def</span> <span class="nf">is_mouse_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouse_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the mouse is currently down.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suspend_mouse_input</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">imgui</span><span class="o">.</span><span class="n">is_mouse_down</span><span class="p">(</span><span class="n">mouse_idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.is_mouse_released"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.is_mouse_released">[docs]</a>    <span class="k">def</span> <span class="nf">is_mouse_released</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouse_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the mouse was released.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suspend_mouse_input</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">imgui</span><span class="o">.</span><span class="n">is_mouse_released</span><span class="p">(</span><span class="n">mouse_idx</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_handle_user_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle user input to support clicking/dragging the main viewer.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mouse_screen_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mouse_screen_y</span> <span class="o">=</span> <span class="n">imgui</span><span class="o">.</span><span class="n">get_mouse_pos</span><span class="p">()</span>
        <span class="c1"># Detect right mouse click in the main display.</span>
        <span class="n">clicking</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">wheel</span> <span class="o">=</span> <span class="n">imgui_utils</span><span class="o">.</span><span class="n">click_hidden_window</span><span class="p">(</span>
            <span class="s1">&#39;##result_area&#39;</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_y</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">content_width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_x</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">content_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_y</span><span class="p">,</span>
            <span class="n">mouse_idx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Ignore right click if the slide widget</span>
        <span class="c1"># is capturing an ROI.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide_widget</span><span class="o">.</span><span class="n">editing_rois</span><span class="p">:</span>
            <span class="n">clicking</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Detect dragging with left mouse in the main display.</span>
        <span class="n">dragging</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">imgui_utils</span><span class="o">.</span><span class="n">drag_hidden_window</span><span class="p">(</span>
            <span class="s1">&#39;##result_area&#39;</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_y</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">content_width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_x</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">content_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_y</span><span class="p">)</span>

        <span class="c1"># Suspend mouse input handling if the user is interacting with a widget.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suspend_mouse_input</span><span class="p">:</span>
            <span class="n">clicking</span><span class="p">,</span> <span class="n">dragging</span><span class="p">,</span> <span class="n">wheel</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">EasyDict</span><span class="p">(</span>
            <span class="n">clicking</span><span class="o">=</span><span class="n">clicking</span><span class="p">,</span>
            <span class="n">dragging</span><span class="o">=</span><span class="n">dragging</span><span class="p">,</span>
            <span class="n">wheel</span><span class="o">=</span><span class="n">wheel</span><span class="p">,</span>
            <span class="n">cx</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">cx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ratio</span><span class="p">),</span>
            <span class="n">cy</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">cy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ratio</span><span class="p">),</span>
            <span class="n">dx</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ratio</span><span class="p">),</span>
            <span class="n">dy</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_ratio</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_and_return_wsi</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stride</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_rois</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tile_px</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tile_um</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">sf</span><span class="o">.</span><span class="n">WSI</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load and return a Whole-Slide Image, with modified parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str, optional): Path to the slide to reload. If not provided,</span>
<span class="sd">                will reload the currently loaded slide.</span>
<span class="sd">            stride (int, optional): Stride to use for the loaded slide. If not</span>
<span class="sd">                provided, will use the stride value from the currently loaded</span>
<span class="sd">                slide.</span>
<span class="sd">            use_rois (bool): Use ROIs from the loaded project, if available.</span>

<span class="sd">        Returns:</span>
<span class="sd">            slideflow.WSI: Reloaded slide.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Path to slide.</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="o">.</span><span class="n">path</span>

        <span class="c1"># Stride.</span>
        <span class="k">if</span> <span class="n">stride</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stride</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">stride</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stride</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="o">.</span><span class="n">stride_div</span>

        <span class="c1"># ROI filter method.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">roi_filter_method</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">roi_filter_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="o">.</span><span class="n">roi_filter_method</span>

        <span class="c1"># ROIs.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">path</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="n">roi_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="o">.</span><span class="n">roi_method</span>
            <span class="n">prior_rois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="o">.</span><span class="n">rois</span>
            <span class="n">rois</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="ow">and</span> <span class="n">use_rois</span><span class="p">:</span>
            <span class="n">rois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dataset</span><span class="p">()</span><span class="o">.</span><span class="n">rois</span><span class="p">()</span>
            <span class="n">roi_method</span><span class="p">,</span> <span class="n">prior_rois</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">roi_method</span><span class="p">,</span> <span class="n">prior_rois</span><span class="p">,</span> <span class="n">rois</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># Cap the number of workers in the CUCIM backend.</span>
        <span class="k">if</span> <span class="n">sf</span><span class="o">.</span><span class="n">slide_backend</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;cucim&#39;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;num_workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">num_cpu</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Tile size.</span>
        <span class="k">if</span> <span class="n">tile_px</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tile_px</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_px</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_px</span> <span class="k">else</span> <span class="mi">256</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tile_um</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tile_um</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_um</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_um</span> <span class="k">else</span> <span class="mi">512</span><span class="p">)</span>

        <span class="c1"># Pass through QC mask if the slide is already loaded.</span>
        <span class="n">qc_mask</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="o">.</span><span class="n">get_qc_mask</span><span class="p">(</span><span class="n">roi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">wsi</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">WSI</span><span class="p">(</span>
                <span class="n">path</span><span class="p">,</span>
                <span class="n">tile_px</span><span class="o">=</span><span class="n">tile_px</span><span class="p">,</span>
                <span class="n">tile_um</span><span class="o">=</span><span class="n">tile_um</span><span class="p">,</span>
                <span class="n">stride_div</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span>
                <span class="n">rois</span><span class="o">=</span><span class="n">rois</span><span class="p">,</span>
                <span class="n">cache_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">tile_width</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
                    <span class="n">tile_height</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
                    <span class="n">max_tiles</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">),</span>
                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">mpp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_widget</span><span class="o">.</span><span class="n">manual_mpp</span><span class="p">,</span>
                <span class="n">use_bounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings_widget</span><span class="o">.</span><span class="n">use_bounds</span><span class="p">,</span>
                <span class="n">roi_filter_method</span><span class="o">=</span><span class="n">roi_filter_method</span><span class="p">,</span>
                <span class="n">simplify_roi_tolerance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings_widget</span><span class="o">.</span><span class="n">simplify_tolerance</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">sf</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">IncompatibleBackendError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_toast</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Incompatbile slide&quot;</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Slide type &quot;</span><span class="si">{}</span><span class="s1">&quot; is incompatible with the </span><span class="si">{}</span><span class="s1"> backend.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">sf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">path_to_ext</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">sf</span><span class="o">.</span><span class="n">slide_backend</span><span class="p">()),</span>
                <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;error&#39;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Reapply QC</span>
            <span class="k">if</span> <span class="n">qc_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wsi</span><span class="o">.</span><span class="n">apply_qc_mask</span><span class="p">(</span><span class="n">qc_mask</span><span class="p">)</span>

            <span class="c1"># Reapply ROIs</span>
            <span class="k">if</span> <span class="n">prior_rois</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wsi</span><span class="o">.</span><span class="n">rois</span> <span class="o">=</span> <span class="n">prior_rois</span>
                <span class="n">wsi</span><span class="o">.</span><span class="n">roi_method</span> <span class="o">=</span> <span class="n">roi_method</span>
                <span class="n">wsi</span><span class="o">.</span><span class="n">process_rois</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">wsi</span>

<div class="viewcode-block" id="Studio.reload_wsi"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.reload_wsi">[docs]</a>    <span class="k">def</span> <span class="nf">reload_wsi</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">slide</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">sf</span><span class="o">.</span><span class="n">WSI</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stride</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_rois</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">tile_px</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tile_um</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the currently loaded Whole-Slide Image.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str or sf.WSI, optional): Slide to reload. May be a path</span>
<span class="sd">                or a sf.WSI object. If not provided, will reload the </span>
<span class="sd">                currently loaded slide.</span>
<span class="sd">            stride (int, optional): Stride to use for the loaded slide. If not</span>
<span class="sd">                provided, will use the stride value from the currently loaded</span>
<span class="sd">                slide.</span>
<span class="sd">            use_rois (bool): Use ROIs from the loaded project, if available.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if slide loaded successfully, False otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slide</span><span class="p">,</span> <span class="n">sf</span><span class="o">.</span><span class="n">WSI</span><span class="p">):</span>
            <span class="n">wsi</span> <span class="o">=</span> <span class="n">slide</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wsi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_and_return_wsi</span><span class="p">(</span>
                <span class="n">slide</span><span class="p">,</span> <span class="n">stride</span><span class="p">,</span> <span class="n">use_rois</span><span class="p">,</span> <span class="n">tile_px</span><span class="p">,</span> <span class="n">tile_um</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">wsi</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span> <span class="o">=</span> <span class="n">wsi</span>
            <span class="n">old_viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_viewer</span><span class="p">(</span><span class="n">SlideViewer</span><span class="p">(</span><span class="n">wsi</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_viewer_kwargs</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">wsi</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old_viewer</span><span class="p">,</span> <span class="n">SlideViewer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">show_thumbnail</span> <span class="o">=</span> <span class="n">old_viewer</span><span class="o">.</span><span class="n">show_thumbnail</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">show_scale</span> <span class="o">=</span> <span class="n">old_viewer</span><span class="o">.</span><span class="n">show_scale</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">_render_prediction_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render a prediction string to below the tile bounding box.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (str): Message to render.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_frame_width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_x_pixels</span>
        <span class="n">max_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_frame_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_y_pixels</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="n">text_utils</span><span class="o">.</span><span class="n">get_texture</span><span class="p">(</span>
            <span class="n">message</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gl_font_size</span><span class="p">,</span>
            <span class="n">max_width</span><span class="o">=</span><span class="n">max_w</span><span class="p">,</span>
            <span class="n">max_height</span><span class="o">=</span><span class="n">max_h</span><span class="p">,</span>
            <span class="n">outline</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">box_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">full_extract_px</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">view_zoom</span>
        <span class="n">text_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">box_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">box_w</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_y</span> <span class="o">+</span> <span class="n">box_w</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">])</span>
        <span class="n">tex</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">text_pos</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_render_control_pane_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform rendering of control panel contents, such as WSI thumbnails,</span>
<span class="sd">        widgets, and heatmaps.&quot;&quot;&quot;</span>

        <span class="c1"># Render WSI thumbnail in the widget.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi_thumb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi_thumb</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi_thumb</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_obj</span><span class="o">.</span><span class="n">is_compatible</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_img</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_tex_to_delete</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_obj</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_obj</span> <span class="o">=</span> <span class="n">gl_utils</span><span class="o">.</span><span class="n">Texture</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_img</span><span class="p">,</span> <span class="n">bilinear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mipmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_img</span><span class="p">)</span>

        <span class="c1"># Display rendered (non-transparent) heatmap in widget.</span>
        <span class="c1"># Render overlay heatmap.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heatmap</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rendered_heatmap</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rendered_heatmap</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_obj</span><span class="o">.</span><span class="n">is_compatible</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_img</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_tex_to_delete</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_obj</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_obj</span> <span class="o">=</span> <span class="n">gl_utils</span><span class="o">.</span><span class="n">Texture</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_img</span><span class="p">,</span> <span class="n">bilinear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mipmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_img</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_viewer_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Keyword arguments to use for loading a Viewer.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">content_frame_width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_x_pixels</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">content_frame_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_y_pixels</span><span class="p">,</span>
            <span class="n">x_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_x_pixels</span><span class="p">,</span>
            <span class="n">y_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_y_pixels</span><span class="p">,</span>
            <span class="n">normalizer</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalizer</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_wsi</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">viz</span><span class="o">=</span><span class="bp">self</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_window_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the minimum window size limits based on loaded widgets.&quot;&quot;&quot;</span>

        <span class="n">minheight</span> <span class="o">=</span> <span class="p">(((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">navbuttons</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
                       <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">navbutton_width</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">/</span> <span class="mi">22</span><span class="p">)))</span>
                     <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_bar_height</span>
                     <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_bar_height</span><span class="p">)</span>

        <span class="n">glfw</span><span class="o">.</span><span class="n">set_window_size_limits</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_glfw_window</span><span class="p">,</span>
            <span class="n">minwidth</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">content_width</span><span class="o">+</span><span class="mi">100</span><span class="p">),</span>
            <span class="n">minheight</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">minheight</span><span class="p">),</span>
            <span class="n">maxwidth</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">maxheight</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># --- Imgui methods -------------------------------------------------------</span>

<div class="viewcode-block" id="Studio.dim_text"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.dim_text">[docs]</a>    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">dim_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render dim text.</span>

<span class="sd">        Examples</span>
<span class="sd">            Render dim text.</span>

<span class="sd">                .. code-block:: python</span>

<span class="sd">                    with studio.dim_text():</span>
<span class="sd">                        imgui.text(&#39;This is dim&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dim</span><span class="p">:</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_TEXT</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">yield</span>
        <span class="k">if</span> <span class="n">dim</span><span class="p">:</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">pop_style_color</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.highlighted"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.highlighted">[docs]</a>    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">highlighted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render highlighted text.</span>

<span class="sd">        Args:</span>
<span class="sd">            enable (bool): Whether to enable highlighting.</span>

<span class="sd">        Examples</span>
<span class="sd">            Render highlighted text.</span>

<span class="sd">                .. code-block:: python</span>

<span class="sd">                    with studio.highlighted(True):</span>
<span class="sd">                        imgui.text(&#39;This is highlighted&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">button_active</span><span class="p">)</span>
        <span class="k">yield</span>
        <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">pop_style_color</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.collapsing_header"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.collapsing_header">[docs]</a>    <span class="k">def</span> <span class="nf">collapsing_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render a collapsing header using the active theme.</span>

<span class="sd">        Examples</span>
<span class="sd">            Render a collapsing header that is open by default.</span>

<span class="sd">                .. code-block:: python</span>

<span class="sd">                    if viz.collapsing_header(&quot;Header&quot;, default=True):</span>
<span class="sd">                        imgui.text(&quot;Text underneath&quot;)</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): Header text.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_HEADER</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_HEADER_HOVERED</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">header_hovered</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_HEADER_ACTIVE</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">header_hovered</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_TEXT</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">header_text</span><span class="p">)</span>
        <span class="n">expanded</span> <span class="o">=</span> <span class="n">imgui_utils</span><span class="o">.</span><span class="n">collapsing_header</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">pop_style_color</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expanded</span></div>

<div class="viewcode-block" id="Studio.collapsing_header2"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.collapsing_header2">[docs]</a>    <span class="k">def</span> <span class="nf">collapsing_header2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render a second-level collapsing header using the active theme.</span>

<span class="sd">        Examples</span>
<span class="sd">            Render a collapsing header that is open by default.</span>

<span class="sd">                .. code-block:: python</span>

<span class="sd">                    if viz.collapsing_header(&quot;Header&quot;, default=True):</span>
<span class="sd">                        imgui.text(&quot;Text underneath&quot;)</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): Header text.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_HEADER</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">header2</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_HEADER_HOVERED</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">header2_hovered</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_HEADER_ACTIVE</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">header2_hovered</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_TEXT</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">header2_text</span><span class="p">)</span>
        <span class="n">expanded</span> <span class="o">=</span> <span class="n">imgui_utils</span><span class="o">.</span><span class="n">collapsing_header</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">pop_style_color</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expanded</span></div>

<div class="viewcode-block" id="Studio.header"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.header">[docs]</a>    <span class="k">def</span> <span class="nf">header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render a header using the active theme.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): Text for the header. Text will be rendered in</span>
<span class="sd">                uppercase.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">imgui_utils</span><span class="o">.</span><span class="n">header</span><span class="p">(</span>
            <span class="n">text</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
            <span class="n">hpad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
            <span class="n">vpad</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="o">*</span><span class="mf">0.4</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="o">*</span><span class="mf">0.75</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Studio.header_with_buttons"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.header_with_buttons">[docs]</a>    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">header_with_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render a widget header with ability to add buttons.</span>

<span class="sd">        Examples</span>
<span class="sd">            Render a header with a gear icon.</span>

<span class="sd">                .. code-block:: python</span>

<span class="sd">                    with studio.header_with_buttons(&#39;Button&#39;):</span>
<span class="sd">                        # Right align the button</span>
<span class="sd">                        x_width = imgui.get_content_region_max()[0]</span>
<span class="sd">                        imgui.same_line(x_width - 30)</span>
<span class="sd">                        cx, cy = imgui.get_cursor_pos()</span>
<span class="sd">                        imgui.set_cursor_position((cx, cy-5))</span>

<span class="sd">                        # Render the button</span>
<span class="sd">                        if sidebar.small_button(&#39;gear&#39;):</span>
<span class="sd">                            do_something()</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): Text for the header. Text will be rendered in</span>
<span class="sd">                uppercase.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">imgui_utils</span><span class="o">.</span><span class="n">header</span><span class="p">(</span>
            <span class="n">text</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
            <span class="n">hpad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
            <span class="n">vpad</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="o">*</span><span class="mf">0.4</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="o">*</span><span class="mf">0.75</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="k">yield</span></div>

<div class="viewcode-block" id="Studio.center_next_window"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.center_next_window">[docs]</a>    <span class="k">def</span> <span class="nf">center_next_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Center the next imgui window.</span>

<span class="sd">        Args:</span>
<span class="sd">            width (int): Width of the next window.</span>
<span class="sd">            height (int): Height of the next window.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_position</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content_width</span> <span class="o">-</span> <span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content_height</span> <span class="o">-</span> <span class="n">height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_bar_height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">)</span></div>

    <span class="c1"># --- Public methods ------------------------------------------------------</span>

<div class="viewcode-block" id="Studio.reset_background"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.reset_background">[docs]</a>    <span class="k">def</span> <span class="nf">reset_background</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the Studio background to the default theme color.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_background_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">main_background</span></div>

<div class="viewcode-block" id="Studio.add_widgets"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.add_widgets">[docs]</a>    <span class="k">def</span> <span class="nf">add_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widgets</span><span class="p">:</span> <span class="n">Widget</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add widget extension(s).</span>

<span class="sd">        Add widgets to Studio and the sidebar. The ``.tag`` property is used</span>
<span class="sd">        as a unique identifier for the widget. The ``.icon`` property should</span>
<span class="sd">        be a path to an image file used for rendering the sidebar navigation</span>
<span class="sd">        icon. ``.icon_highlighted`` property should be a path to an image file</span>
<span class="sd">        used for rendering a hovered navigation icon.</span>

<span class="sd">        The widget should implement ``__call__()`` and ``.close()`` methods</span>
<span class="sd">        for rendering the imgui GUI and cleanup, respectively.</span>

<span class="sd">        Args:</span>
<span class="sd">            widgets (list(:class:`slideflow.studio.widgets.Widget`)): List of</span>
<span class="sd">                widgets to add as extensions. These should be classes, not</span>
<span class="sd">                instantiated objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widgets</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">widgets</span> <span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">widgets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span> <span class="o">+=</span> <span class="p">[</span><span class="n">widget</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">add_widgets</span><span class="p">(</span><span class="n">widgets</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_window_limits</span><span class="p">()</span></div>

<div class="viewcode-block" id="Studio.remove_widget"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.remove_widget">[docs]</a>    <span class="k">def</span> <span class="nf">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">:</span> <span class="n">Widget</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a widget from Studio.</span>

<span class="sd">        Args:</span>
<span class="sd">            widget (:class:`slideflow.studio.widgets.Widget`): Widget to remove.</span>
<span class="sd">                This should be a class, not an instantiated object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">widget_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">w_idx</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
                <span class="n">widget_obj</span> <span class="o">=</span> <span class="n">w</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">widget_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not find widget &quot;</span><span class="si">{</span><span class="n">widget</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">widget_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">widget_obj</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_window_limits</span><span class="p">()</span></div>

<div class="viewcode-block" id="Studio.add_to_render_pipeline"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.add_to_render_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_render_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">renderer</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a renderer to the rendering pipeline.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addl_renderers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">renderer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">add_to_render_pipeline</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.remove_from_render_pipeline"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.remove_from_render_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">remove_from_render_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a renderer from the render pipeline.</span>

<span class="sd">        Remove a renderer added with ``.add_to_render_pipeline()``.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the renderer to remove.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addl_renderers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not find renderer &quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">renderer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addl_renderers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">remove_from_render_pipeline</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addl_renderers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

<div class="viewcode-block" id="Studio.ask_load_heatmap"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.ask_load_heatmap">[docs]</a>    <span class="k">def</span> <span class="nf">ask_load_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prompt user for location of exported heatmap (\*.npz) and load.&quot;&quot;&quot;</span>
        <span class="n">npz_path</span> <span class="o">=</span> <span class="n">askopenfilename</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Load heatmap...&quot;</span><span class="p">,</span> <span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;*.npz&quot;</span><span class="p">,</span> <span class="s2">&quot;*.npz&quot;</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">npz_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_heatmap</span><span class="p">(</span><span class="n">npz_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.ask_load_model"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.ask_load_model">[docs]</a>    <span class="k">def</span> <span class="nf">ask_load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prompt user for location of a model and load.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sf</span><span class="o">.</span><span class="n">backend</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;tensorflow&#39;</span><span class="p">:</span>
            <span class="n">model_path</span> <span class="o">=</span> <span class="n">askdirectory</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Load model (directory)...&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model_path</span> <span class="o">=</span> <span class="n">askopenfilename</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Load model...&quot;</span><span class="p">,</span> <span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;zip&quot;</span><span class="p">,</span> <span class="s2">&quot;.zip&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;All files&quot;</span><span class="p">,</span> <span class="s2">&quot;.*&quot;</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">model_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.ask_load_project"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.ask_load_project">[docs]</a>    <span class="k">def</span> <span class="nf">ask_load_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prompt user for location of a project and load.&quot;&quot;&quot;</span>
        <span class="n">project_path</span> <span class="o">=</span> <span class="n">askdirectory</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Load project (directory)...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">project_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_project</span><span class="p">(</span><span class="n">project_path</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.ask_load_slide"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.ask_load_slide">[docs]</a>    <span class="k">def</span> <span class="nf">ask_load_slide</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prompt user for location of a slide and load.&quot;&quot;&quot;</span>
        <span class="n">slide_path</span> <span class="o">=</span> <span class="n">askopenfilename</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Load slide...&quot;</span><span class="p">,</span> <span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;All files&quot;</span><span class="p">,</span> <span class="s2">&quot;.*&quot;</span><span class="p">),</span>
                                                                       <span class="p">(</span><span class="s2">&quot;Aperio ScanScope&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;*.svs&quot;</span><span class="p">,</span> <span class="s2">&quot;*.svslide&quot;</span><span class="p">)),</span>
                                                                       <span class="p">(</span><span class="s2">&quot;Hamamatsu&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;*.ndpi&quot;</span><span class="p">,</span> <span class="s2">&quot;*.vms&quot;</span><span class="p">,</span> <span class="s2">&quot;*.vmu&quot;</span><span class="p">)),</span>
                                                                       <span class="p">(</span><span class="s2">&quot;Leica&quot;</span><span class="p">,</span> <span class="s2">&quot;*.scn&quot;</span><span class="p">),</span>
                                                                       <span class="p">(</span><span class="s2">&quot;MIRAX&quot;</span><span class="p">,</span> <span class="s2">&quot;*.mrxs&quot;</span><span class="p">),</span>
                                                                       <span class="p">(</span><span class="s2">&quot;Roche, Ventana&quot;</span><span class="p">,</span> <span class="s2">&quot;*.bif&quot;</span><span class="p">),</span>
                                                                       <span class="p">(</span><span class="s2">&quot;Pyramid TIFF&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;*.tiff&quot;</span><span class="p">,</span> <span class="s2">&quot;*.tif&quot;</span><span class="p">)),</span>
                                                                       <span class="p">(</span><span class="s2">&quot;JPEG&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;*.jpeg&quot;</span><span class="p">))])</span>
        <span class="k">if</span> <span class="n">slide_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_slide</span><span class="p">(</span><span class="n">slide_path</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.autoload"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.autoload">[docs]</a>    <span class="k">def</span> <span class="nf">autoload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Automatically load a path, detecting the type of object to load.</span>

<span class="sd">        Supports slides, models, projects, and other items supported by</span>
<span class="sd">        widgets if the widget has implemented a `.drag_and_drop_hook` function.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to file to load.</span>
<span class="sd">            ignore_errors (bool): Gracefully handle errors.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Auto-loading [green]</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">is_project</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_project</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">is_slide</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_slide</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">is_model</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;tflite&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;npz&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_heatmap</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># See if any widgets implement a drag_and_drop_hook() method</span>
            <span class="n">handled</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
                <span class="n">sf</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempting load with widget </span><span class="si">{</span><span class="n">widget</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="s1">&#39;drag_and_drop_hook&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">widget</span><span class="o">.</span><span class="n">drag_and_drop_hook</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                        <span class="n">handled</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">handled</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_toast</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No loading handler found for </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.clear_overlay"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.clear_overlay">[docs]</a>    <span class="k">def</span> <span class="nf">clear_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the current overlay image, include heatmaps and masks.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlay</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlay_original</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">clear_overlay</span><span class="p">()</span></div>

<div class="viewcode-block" id="Studio.clear_result"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.clear_result">[docs]</a>    <span class="k">def</span> <span class="nf">clear_result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all shown results and images.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_model_results</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_overlay</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">EasyDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">EasyDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wsi_tex_img</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="Studio.clear_message"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.clear_message">[docs]</a>    <span class="k">def</span> <span class="nf">clear_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear a specific message from display, if the message is being shown.</span>

<span class="sd">        Args:</span>
<span class="sd">            msg (str): Message to clear.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether message was cleared from display.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span> <span class="o">==</span> <span class="n">msg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_message</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">clear_prediction_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pred_message</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Studio.clear_model_results"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.clear_model_results">[docs]</a>    <span class="k">def</span> <span class="nf">clear_model_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all model results and associated images.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">clear_result</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span>       <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_img</span>      <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_obj</span>      <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_img</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heatmap_tex_obj</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">clear_overlay</span><span class="p">()</span></div>

<div class="viewcode-block" id="Studio.close"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the application and renderer.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span>
                <span class="n">w</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Studio.close_model"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.close_model">[docs]</a>    <span class="k">def</span> <span class="nf">close_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">now</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the currently loaded model.</span>

<span class="sd">        Args:</span>
<span class="sd">            now (bool): Close the model now, instead of at the end of the frame.</span>
<span class="sd">                Defaults to False (closes model at frame end).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">now</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_close_model_now</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_should_close_model</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_should_close_model</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Studio.close_slide"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.close_slide">[docs]</a>    <span class="k">def</span> <span class="nf">close_slide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">now</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the currently loaded slide.</span>

<span class="sd">        Args:</span>
<span class="sd">            now (bool): Close the slide now, instead of at the end of the frame.</span>
<span class="sd">                Defaults to False (closes slide at frame end).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">now</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_close_slide_now</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_should_close_slide</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_should_close_slide</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Studio.defer_rendering"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.defer_rendering">[docs]</a>    <span class="k">def</span> <span class="nf">defer_rendering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_frames</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Defer rendering for a number of frames.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defer_rendering</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_defer_rendering</span><span class="p">,</span> <span class="n">num_frames</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.draw_frame"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.draw_frame">[docs]</a>    <span class="k">def</span> <span class="nf">draw_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main draw loop.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">begin_frame</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">EasyDict</span><span class="p">(</span><span class="n">use_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_uncertainty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_saliency</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_w</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mf">4.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu_bar_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">max_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_frame_width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_x_pixels</span>
        <span class="n">max_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_frame_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_y_pixels</span>
        <span class="n">window_changed</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_content_width</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_width</span>
                          <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content_height</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_height</span>
                          <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pane_w</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pane_w</span><span class="p">)</span>

        <span class="c1"># Process drag-and-drop files</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_drag_and_drop_paths</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">autoload</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_textures</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_control_pane</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_menu_bar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_about_dialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_mpp_zoom_dialog</span><span class="p">()</span>

        <span class="n">user_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_user_input</span><span class="p">()</span>

        <span class="c1"># Re-generate WSI view if the window size changed, or if we don&#39;t</span>
        <span class="c1"># yet have a SlideViewer initialized.</span>
        <span class="k">if</span> <span class="n">window_changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_content_width</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_width</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_content_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_height</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pane_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pane_w</span>

            <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="s1">&#39;_on_window_change&#39;</span><span class="p">):</span>
                    <span class="n">widget</span><span class="o">.</span><span class="n">_on_window_change</span><span class="p">()</span>

        <span class="c1"># Main display.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_viewer_kwargs</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_main_view</span><span class="p">(</span><span class="n">user_input</span><span class="p">,</span> <span class="n">window_changed</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_empty_background</span><span class="p">()</span>

        <span class="c1"># --- Render arguments ------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">tile_px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_px</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">tile_um</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_um</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_model</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">tile_px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span><span class="p">[</span><span class="s1">&#39;tile_px&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">tile_um</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span><span class="p">[</span><span class="s1">&#39;tile_um&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;img_format&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_model_img_fmt</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">img_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span><span class="p">[</span><span class="s1">&#39;img_format&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">use_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">use_uncertainty</span> <span class="o">=</span>  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">has_uq</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_uncertainty</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">use_saliency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_saliency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">normalizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalizer</span>

        <span class="c1"># Buffer tile view if using a live viewer.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_live_viewer</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">x</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">is_async</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">_args_queue</span><span class="o">.</span><span class="n">qsize</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defer_tile_refresh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_defer_tile_refresh</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">defer_rendering</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defer_tile_refresh</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">defer_rendering</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_defer_tile_refresh</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">full_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">tile_view</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">tile_px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">tile_px</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">tile_um</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">tile_um</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">apply_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_live_viewer</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span>
        <span class="c1"># ---------------------------------------------------------------------</span>

        <span class="c1"># Render control pane contents.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_render_control_pane_contents</span><span class="p">()</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_skipping_frames</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defer_rendering</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_defer_rendering</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">set_args</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
                <span class="k">if</span> <span class="s1">&#39;predictions&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">predictions</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">uncertainty</span>

        <span class="c1"># Update input image textures (tile view).</span>
        <span class="n">middle_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_x_pixels</span> <span class="o">+</span> <span class="n">max_w</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_h</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;image&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tex_img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">image</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tex_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">image</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tex_obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tex_obj</span><span class="o">.</span><span class="n">is_compatible</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tex_img</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tex_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_tex_to_delete</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_tex_obj</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tex_obj</span> <span class="o">=</span> <span class="n">gl_utils</span><span class="o">.</span><span class="n">Texture</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tex_img</span><span class="p">,</span> <span class="n">bilinear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mipmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tex_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tex_img</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;normalized&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">normalized</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">normalized</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_obj</span><span class="o">.</span><span class="n">is_compatible</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_img</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_tex_to_delete</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_obj</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_obj</span> <span class="o">=</span> <span class="n">gl_utils</span><span class="o">.</span><span class="n">Texture</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_img</span><span class="p">,</span> <span class="n">bilinear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mipmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_norm_tex_img</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;message&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;message&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">:</span>
            <span class="n">_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="s1">&#39;message&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="n">text_utils</span><span class="o">.</span><span class="n">get_texture</span><span class="p">(</span><span class="n">_msg</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gl_font_size</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">max_w</span><span class="p">,</span> <span class="n">max_height</span><span class="o">=</span><span class="n">max_h</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">tex</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">middle_pos</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Render user widgets.</span>
        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="s1">&#39;render&#39;</span><span class="p">):</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>

        <span class="c1"># Render slide widget tile boxes (for tile extraction preview)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slide_widget</span><span class="o">.</span><span class="n">early_render</span><span class="p">()</span>

        <span class="c1"># Render the tile view and status bar.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_tile_view</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_status_bar</span><span class="p">()</span>

        <span class="c1"># Draw prediction message next to box on main display.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pred_message</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_render_prediction_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pred_message</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_use_model</span>
           <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
           <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
           <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="s1">&#39;in_focus&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">in_focus</span><span class="p">:</span>
                <span class="n">pred_str</span> <span class="o">=</span> <span class="n">prediction_to_string</span><span class="p">(</span>
                    <span class="n">predictions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">,</span>
                    <span class="n">outcomes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span><span class="p">[</span><span class="s1">&#39;outcome_labels&#39;</span><span class="p">],</span>
                    <span class="n">is_classification</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span><span class="p">[</span><span class="s1">&#39;model_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;classification&#39;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_render_prediction_message</span><span class="p">(</span><span class="n">pred_str</span><span class="p">)</span>

        <span class="c1"># End frame.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_close_model</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_model</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_close_slide</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_slide</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_frame</span><span class="p">()</span></div>

<div class="viewcode-block" id="Studio.get_default_widgets"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.get_default_widgets">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_default_widgets</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of the default non-mandatory extension widgets.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Studio.get_renderer"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.get_renderer">[docs]</a>    <span class="k">def</span> <span class="nf">get_renderer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Renderer</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for the given additional renderer in the rendering pipeline.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the renderer to check for. If None,</span>
<span class="sd">                returns the main renderer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Renderer if name is a recognized renderer, otherwise None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">_renderer_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">_renderer_obj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addl_renderers</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addl_renderers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Studio.get_extension"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.get_extension">[docs]</a>    <span class="k">def</span> <span class="nf">get_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Widget</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a given widget (extension) by tag.</span>

<span class="sd">        Args:</span>
<span class="sd">            tag (str): Tag of the widget to search for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            slideflow.studio.widgets.Widget if found, else None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">tag</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">w</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Studio.get_widget"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.get_widget">[docs]</a>    <span class="k">def</span> <span class="nf">get_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Widget</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a given widget by class name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the widget to search for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            slideflow.studio.widgets.Widget</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the widget could not be found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">w</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to find widget with class name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.has_live_viewer"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.has_live_viewer">[docs]</a>    <span class="k">def</span> <span class="nf">has_live_viewer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the current viewer is a live viewer (e.g. camera feed).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">live</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.has_uq"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.has_uq">[docs]</a>    <span class="k">def</span> <span class="nf">has_uq</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the current model supports uncertainty quantification.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="s1">&#39;uq&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span><span class="p">[</span><span class="s1">&#39;hp&#39;</span><span class="p">]</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span><span class="p">[</span><span class="s1">&#39;hp&#39;</span><span class="p">][</span><span class="s1">&#39;uq&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Studio.ask_zoom_to_mpp"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.ask_zoom_to_mpp">[docs]</a>    <span class="k">def</span> <span class="nf">ask_zoom_to_mpp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prompt the user to zoom to a specific microns-per-pixel (MPP).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">,</span> <span class="n">SlideViewer</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_mpp_zoom_popup</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Studio.increase_tile_zoom"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.increase_tile_zoom">[docs]</a>    <span class="k">def</span> <span class="nf">increase_tile_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Increase zoom of tile view two-fold.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_zoom</span> <span class="o">*=</span> <span class="mi">2</span></div>

<div class="viewcode-block" id="Studio.decrease_tile_zoom"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.decrease_tile_zoom">[docs]</a>    <span class="k">def</span> <span class="nf">decrease_tile_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Decrease zoom of tile view by half.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_zoom</span> <span class="o">/=</span> <span class="mi">2</span></div>

<div class="viewcode-block" id="Studio.reset_tile_zoom"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.reset_tile_zoom">[docs]</a>    <span class="k">def</span> <span class="nf">reset_tile_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset tile zoom level.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_zoom</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Studio.load_heatmap"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.load_heatmap">[docs]</a>    <span class="k">def</span> <span class="nf">load_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;sf.Heatmap&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a saved heatmap (\*.npz).</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to exported heatmap in \*.npz format, as generated</span>
<span class="sd">                by Heatmap.save() or Heatmap.save_npz().</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_toast</span><span class="p">(</span>
                <span class="s2">&quot;Unable to load heatmap; model must also be loaded.&quot;</span><span class="p">,</span>
                <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;error&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_widget</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_toast</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded heatmap at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Exception raised loading heatmap: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_toast</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading heatmap at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.load_model"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.load_model">[docs]</a>    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the given model.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (str): Path to Slideflow model (in either backend).</span>
<span class="sd">            ignore_errors (bool): Do not fail if an error is encountered.</span>
<span class="sd">                Defaults to False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Loading model from Studio&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_model</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Model closed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_result</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Model result cleared&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_frame</span><span class="p">()</span> <span class="c1"># The input field will change on next frame.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span> <span class="c1"># Flush prior result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">clear_result</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># Trigger user widgets</span>
            <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="s1">&#39;_before_model_load&#39;</span><span class="p">):</span>
                    <span class="n">widget</span><span class="o">.</span><span class="n">_before_model_load</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">defer_rendering</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_widget</span><span class="o">.</span><span class="n">user_model</span> <span class="o">=</span> <span class="n">model</span>

            <span class="c1"># Read model configuration</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_model_config</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="n">normalizer</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_model_normalizer</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Loading </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">...&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defer_rendering</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_use_model</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_path</span> <span class="o">=</span> <span class="n">model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span> <span class="o">=</span> <span class="n">config</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normalizer</span> <span class="o">=</span> <span class="n">normalizer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_use_uncertainty</span> <span class="o">=</span> <span class="s1">&#39;uq&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;hp&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;hp&#39;</span><span class="p">][</span><span class="s1">&#39;uq&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile_um</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;tile_um&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile_px</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;tile_px&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">torch_available</span> <span class="ow">and</span> <span class="n">sf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">path_to_ext</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;zip&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_widget</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="s1">&#39;torch&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_widget</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="s1">&#39;tensorflow&#39;</span>

            <span class="c1"># Update widgets</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Updating widgets&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_widget</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_widget</span><span class="o">.</span><span class="n">cur_model</span> <span class="o">=</span> <span class="n">model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_widget</span><span class="o">.</span><span class="n">use_model</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_widget</span><span class="o">.</span><span class="n">use_uncertainty</span> <span class="o">=</span> <span class="s1">&#39;uq&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;hp&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;hp&#39;</span><span class="p">][</span><span class="s1">&#39;uq&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">normalizer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;slide_widget&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slide_widget</span><span class="o">.</span><span class="n">add_model_normalizer_option</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slide_widget</span><span class="o">.</span><span class="n">norm_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_widget</span><span class="o">.</span><span class="n">_normalizer_methods</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading slide... tile_px=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_px</span><span class="si">}</span><span class="s2">, tile_um=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_um</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slide_widget</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                    <span class="n">mpp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_widget</span><span class="o">.</span><span class="n">manual_mpp</span><span class="p">,</span>
                    <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;heatmap_widget&#39;</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Resetting heatmap&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heatmap_widget</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">expanded</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="s1">&#39;model&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">expanded</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Update viewer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_tile_preview</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Updating viewer with tile_px=</span><span class="si">{}</span><span class="s2">, tile_um=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_px</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_um</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">,</span> <span class="n">SlideViewer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">set_tile_px</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_px</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">set_tile_um</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_um</span><span class="p">)</span>

            <span class="c1"># Trigger user widgets</span>
            <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="s1">&#39;_on_model_load&#39;</span><span class="p">):</span>
                    <span class="n">widget</span><span class="o">.</span><span class="n">_on_model_load</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">create_toast</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded model at </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_widget</span><span class="o">.</span><span class="n">cur_model</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Exception raised: no model loaded.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">EasyDict</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;No model loaded&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Exception raised (ignore_errors=</span><span class="si">{}</span><span class="s2">): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ignore_errors</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_toast</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading model at </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">EasyDict</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="n">CapturedException</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_errors</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Model loading complete (path=</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_path</span><span class="p">))</span></div>

<div class="viewcode-block" id="Studio.load_project"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.load_project">[docs]</a>    <span class="k">def</span> <span class="nf">load_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the given project.</span>

<span class="sd">        Args:</span>
<span class="sd">            project (str): Path to Slideflow project.</span>
<span class="sd">            ignore_errors (bool): Do not fail if an error is encountered.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_widget</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.load_slide"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.load_slide">[docs]</a>    <span class="k">def</span> <span class="nf">load_slide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slide</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the given slide.</span>

<span class="sd">        Args:</span>
<span class="sd">            slide (str): Path to whole-slide image.</span>
<span class="sd">            stride (int, optional): Stride for tiles. 1 is non-overlapping</span>
<span class="sd">                tiles, 2 is tiles with 50% overlap, etc. Defaults to 1.</span>
<span class="sd">            ignore_errors (bool): Do not fail if an error is encountered.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slide_widget</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">slide</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Trigger user widgets</span>
        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="s1">&#39;_on_slide_load&#39;</span><span class="p">):</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">_on_slide_load</span><span class="p">()</span></div>

<div class="viewcode-block" id="Studio.print_error"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.print_error">[docs]</a>    <span class="k">def</span> <span class="nf">print_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the given error message.&quot;&quot;&quot;</span>
        <span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_error_print</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">error</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_error_print</span> <span class="o">=</span> <span class="n">error</span></div>

<div class="viewcode-block" id="Studio.reload_model"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.reload_model">[docs]</a>    <span class="k">def</span> <span class="nf">reload_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the current model.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.reload_viewer"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.reload_viewer">[docs]</a>    <span class="k">def</span> <span class="nf">reload_viewer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the current main viewer.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">,</span> <span class="n">SlideViewer</span><span class="p">):</span>
                <span class="n">old_viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_viewer</span><span class="p">(</span><span class="n">SlideViewer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_viewer_kwargs</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">show_thumbnail</span> <span class="o">=</span> <span class="n">old_viewer</span><span class="o">.</span><span class="n">show_thumbnail</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">show_scale</span> <span class="o">=</span> <span class="n">old_viewer</span><span class="o">.</span><span class="n">show_scale</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_viewer_kwargs</span><span class="p">())</span></div>

<div class="viewcode-block" id="Studio.set_message"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.set_message">[docs]</a>    <span class="k">def</span> <span class="nf">set_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a message for display.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_message</span> <span class="o">=</span> <span class="n">msg</span></div>

<div class="viewcode-block" id="Studio.set_status_message"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.set_status_message">[docs]</a>    <span class="k">def</span> <span class="nf">set_status_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">text_color</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">rounding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the status message to display in the status bar.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_status_message</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_message</span> <span class="o">=</span> <span class="n">StatusMessage</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">message</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">text_color</span><span class="o">=</span><span class="n">text_color</span><span class="p">,</span>
            <span class="n">rounding</span><span class="o">=</span><span class="n">rounding</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Studio.clear_status_message"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.clear_status_message">[docs]</a>    <span class="k">def</span> <span class="nf">clear_status_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the status message from the status bar.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_message</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Studio.set_prediction_message"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.set_prediction_message">[docs]</a>    <span class="k">def</span> <span class="nf">set_prediction_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the prediction message to display under the tile outline.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pred_message</span> <span class="o">=</span> <span class="n">msg</span></div>

<div class="viewcode-block" id="Studio.set_overlay"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.set_overlay">[docs]</a>    <span class="k">def</span> <span class="nf">set_overlay</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">overlay</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">original</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure the overlay to be applied to the current view screen.</span>

<span class="sd">        Overlay is a numpy array, and method is a flag indicating the</span>
<span class="sd">        method to use when showing the overlay.</span>

<span class="sd">        If ``method`` is ``sf.studio.OVERLAY_WSI``, the array will be mapped</span>
<span class="sd">        to the entire whole-slide image, without offsets.</span>

<span class="sd">        If ``method`` is ``sf.studio.OVERLAY_GRID``, the array is interpreted</span>
<span class="sd">        as having been generated from the slide&#39;s grid, meaning that an offset</span>
<span class="sd">        will be applied to ensure that the overlay is aligned properly.</span>

<span class="sd">        If ``method`` is ``sf.studio.OVERLAY_VIEW``, the array is interpreted</span>
<span class="sd">        as an overlay that is applied only to the area of the slide</span>
<span class="sd">        currently in view.</span>

<span class="sd">        Args:</span>
<span class="sd">            overlay (np.ndarray): Overlay to render.</span>
<span class="sd">            method (int): Mapping method for linking the overlay to the</span>
<span class="sd">                whole-slide image.</span>

<span class="sd">        Keyword args:</span>
<span class="sd">            original (np.ndarray, optional): Original grid values before any</span>
<span class="sd">                colorization or other modifications. Used for displaying the</span>
<span class="sd">                tooltip when alt-hovering. Defaults to None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unable to set overlay; viewer not loaded.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">original</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">original</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unable to set grid overlay; original grid shape &quot;</span>
                             <span class="s2">&quot;does not match grid shape.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlay_original</span> <span class="o">=</span> <span class="n">original</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="n">OVERLAY_WSI</span><span class="p">:</span>
            <span class="c1"># Overlay maps to the entire whole-slide image,</span>
            <span class="c1"># with no offset needed.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_overlay_wsi_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="o">.</span><span class="n">dimensions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_overlay_offset_wsi_dim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="n">OVERLAY_GRID</span><span class="p">:</span>
            <span class="c1"># Overlay was generated from the slide&#39;s grid, meaning</span>
            <span class="c1"># that we need to apply an offset to ensure the overlay</span>
            <span class="c1"># lines up apppropriately.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid_overlay</span><span class="p">(</span><span class="n">overlay</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="n">OVERLAY_VIEW</span><span class="p">:</span>
            <span class="c1"># Overlay should only apply to the area of the WSI</span>
            <span class="c1"># currently in view.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_overlay_wsi_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">wsi_window_size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_overlay_offset_wsi_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">origin</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecognized method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.set_grid_overlay"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.set_grid_overlay">[docs]</a>    <span class="k">def</span> <span class="nf">set_grid_overlay</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">grid</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">tile_um</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stride_div</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mpp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">original</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the grid overlay to the given grid.</span>

<span class="sd">        Args:</span>
<span class="sd">            grid (np.ndarray): Grid to render as an overlay.</span>

<span class="sd">        Keyword args:</span>
<span class="sd">            tile_um (int, optional): Tile size, in microns. If None, uses</span>
<span class="sd">                the tile size of the currently loaded slide.</span>
<span class="sd">            stride_div (int, optional): Stride divisor. If None, uses</span>
<span class="sd">                the stride divisor of the currently loaded slide.</span>
<span class="sd">            mpp (float, optional): Microns per pixel. If None, uses</span>
<span class="sd">                the MPP of the currently loaded slide.</span>
<span class="sd">            original (np.ndarray, optional): Original grid values before any</span>
<span class="sd">                colorization or other modifications. Used for displaying the</span>
<span class="sd">                tooltip when alt-hovering. Defaults to None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unable to set grid overlay; viewer not loaded.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">tile_um</span><span class="p">,</span> <span class="n">stride_div</span><span class="p">,</span> <span class="n">mpp</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unable to set grid overlay; no slide loaded.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">original</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">original</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unable to set grid overlay; original grid shape &quot;</span>
                             <span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">) does not match grid shape (</span><span class="si">{}</span><span class="s2">).&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">original</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span>
                             <span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">overlay</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlay_original</span> <span class="o">=</span> <span class="n">original</span>
        <span class="k">if</span> <span class="n">tile_um</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tile_um</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="o">.</span><span class="n">tile_um</span>
        <span class="k">if</span> <span class="n">stride_div</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stride_div</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="o">.</span><span class="n">stride_div</span>
        <span class="k">if</span> <span class="n">mpp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mpp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsi</span><span class="o">.</span><span class="n">mpp</span>
        <span class="n">full_extract</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tile_um</span> <span class="o">/</span> <span class="n">mpp</span><span class="p">)</span>
        <span class="n">wsi_stride</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">full_extract</span> <span class="o">/</span> <span class="n">stride_div</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overlay_wsi_dim</span> <span class="o">=</span> <span class="p">(</span><span class="n">wsi_stride</span> <span class="o">*</span> <span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                 <span class="n">wsi_stride</span> <span class="o">*</span> <span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overlay_offset_wsi_dim</span> <span class="o">=</span> <span class="p">(</span><span class="n">full_extract</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">wsi_stride</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">full_extract</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">wsi_stride</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Studio.set_viewer"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Studio.set_viewer">[docs]</a>    <span class="k">def</span> <span class="nf">set_viewer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the main viewer.</span>

<span class="sd">        Args:</span>
<span class="sd">            viewer (:class:`slideflow.studio.gui.viewer.Viewer`): Viewer to use.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting viewer to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">viewer</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="n">viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">_live_updates</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">live</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_render_manager</span><span class="o">.</span><span class="n">set_async</span><span class="p">(</span><span class="n">viewer</span><span class="o">.</span><span class="n">live</span><span class="p">)</span></div></div>

<span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Sidebar"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Sidebar">[docs]</a><span class="k">class</span> <span class="nc">Sidebar</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sidebar for Studio, rendering a navigation bar and widgets.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Sidebar.__init__"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Sidebar.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viz</span><span class="p">:</span> <span class="n">Studio</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viz</span>                <span class="o">=</span> <span class="n">viz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expanded</span>           <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buttonbar_width</span>   <span class="o">=</span> <span class="mi">63</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_navbutton_width</span>   <span class="o">=</span> <span class="mi">61</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imagebutton_width</span> <span class="o">=</span> <span class="mi">56</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_button_tex</span>        <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pane_w_div</span>        <span class="o">=</span> <span class="mi">15</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">navbuttons</span>         <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">,</span> <span class="s1">&#39;slide&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;heatmap&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_widgets</span><span class="p">(</span><span class="n">viz</span><span class="o">.</span><span class="n">widgets</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_button_textures</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">buttonbar_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buttonbar_width</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">font_size</span> <span class="o">/</span> <span class="mi">22</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">navbutton_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_navbutton_width</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">font_size</span> <span class="o">/</span> <span class="mi">22</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">imagebutton_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_imagebutton_width</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">font_size</span> <span class="o">/</span> <span class="mi">22</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">w</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">theme</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Active Studio theme.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">theme</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Widget width.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pane_w_div</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">full_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Width of the expanded sidebar, including navigation and widgets.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttonbar_width</span>

    <span class="c1"># --- Internals -----------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_set_sidebar_style</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the Imgui sidebar style based on the active theme.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">theme</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_FRAME_BACKGROUND</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">item_background</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_FRAME_BACKGROUND_HOVERED</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">item_hover</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BORDER</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">border</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_WINDOW_BACKGROUND</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">sidebar_background</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">button</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON_HOVERED</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">button_hovered</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON_ACTIVE</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">button_active</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_PLOT_HISTOGRAM</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">accent</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_PLOT_HISTOGRAM_HOVERED</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">accent_hovered</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_end_sidebar_style</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;End the Imgui sidebar style based on the active theme.&quot;&quot;&quot;</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">pop_style_color</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_sidebar_button_style</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the Imgui sidebar button style based on the active theme.&quot;&quot;&quot;</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_WINDOW_BACKGROUND</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">sidebar_background</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON_HOVERED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON_ACTIVE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BORDER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_var</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">STYLE_WINDOW_PADDING</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_var</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">STYLE_ITEM_SPACING</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_end_sidebar_button_style</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;End the Imgui sidebar button style based on the active theme.&quot;&quot;&quot;</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">pop_style_color</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">pop_style_var</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_button_textures</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload textures for buttons.&quot;&quot;&quot;</span>
        <span class="n">button_dir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;gui&#39;</span><span class="p">,</span> <span class="s1">&#39;buttons&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">navbuttons</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;gear&#39;</span><span class="p">,</span> <span class="s1">&#39;circle_lightning&#39;</span><span class="p">,</span> <span class="s1">&#39;circle_plus&#39;</span><span class="p">,</span> <span class="s1">&#39;pencil&#39;</span><span class="p">,</span> <span class="s1">&#39;folder&#39;</span><span class="p">,</span> <span class="s1">&#39;floppy&#39;</span><span class="p">,</span> <span class="s1">&#39;model_loaded&#39;</span><span class="p">,</span> <span class="s1">&#39;extensions&#39;</span><span class="p">,</span> <span class="s1">&#39;add_freehand&#39;</span><span class="p">,</span> <span class="s1">&#39;add_polygon&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">bname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">[</span><span class="n">bname</span><span class="p">]</span> <span class="o">=</span> <span class="n">gl_utils</span><span class="o">.</span><span class="n">Texture</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">button_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;button_</span><span class="si">{</span><span class="n">bname</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)),</span> <span class="n">bilinear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mipmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">bname</span><span class="si">}</span><span class="s1">_highlighted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gl_utils</span><span class="o">.</span><span class="n">Texture</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">button_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;button_</span><span class="si">{</span><span class="n">bname</span><span class="si">}</span><span class="s1">_highlighted.png&#39;</span><span class="p">)),</span> <span class="n">bilinear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mipmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;vips&#39;</span><span class="p">,</span> <span class="s1">&#39;cucim&#39;</span><span class="p">,</span> <span class="s1">&#39;lowmem&#39;</span><span class="p">,</span> <span class="s1">&#39;ellipsis&#39;</span><span class="p">,</span> <span class="s1">&#39;gear&#39;</span><span class="p">,</span> <span class="s1">&#39;refresh&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;small_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;small_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gl_utils</span><span class="o">.</span><span class="n">Texture</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">button_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;small_button_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)),</span> <span class="n">bilinear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mipmap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">maxlevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_navbar_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">start_px</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw a navigation bar button.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the image associated with the button.</span>
<span class="sd">            start_px (int): Starting location of the button (y coordinates).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">viz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz</span>

        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span> <span class="ow">and</span> <span class="n">viz</span><span class="o">.</span><span class="n">_model_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tex_name</span> <span class="o">=</span> <span class="s1">&#39;model_loaded&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex_name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">imgui</span><span class="o">.</span><span class="n">get_mouse_pos</span><span class="p">()</span>
        <span class="n">cy</span> <span class="o">-=</span> <span class="n">viz</span><span class="o">.</span><span class="n">menu_bar_height</span>
        <span class="n">end_px</span> <span class="o">=</span> <span class="n">start_px</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">navbutton_width</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">cx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">cx</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">navbutton_width</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">cy</span> <span class="o">&lt;</span> <span class="n">start_px</span> <span class="ow">or</span> <span class="n">cy</span> <span class="o">&gt;</span> <span class="n">end_px</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">!=</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">[</span><span class="n">tex_name</span><span class="p">]</span><span class="o">.</span><span class="n">gl_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">tex_name</span><span class="si">}</span><span class="s1">_highlighted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gl_id</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">set_cursor_position</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_px</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">imgui</span><span class="o">.</span><span class="n">image_button</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagebutton_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagebutton_width</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">expanded</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expanded</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">expanded</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># Add a line next to the selected/active widget.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">draw_list</span> <span class="o">=</span> <span class="n">imgui</span><span class="o">.</span><span class="n">get_window_draw_list</span><span class="p">()</span>
            <span class="n">draw_list</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">viz</span><span class="o">.</span><span class="n">menu_bar_height</span><span class="o">+</span><span class="n">start_px</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">viz</span><span class="o">.</span><span class="n">menu_bar_height</span><span class="o">+</span><span class="n">start_px</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">navbutton_width</span><span class="p">,</span> <span class="n">imgui</span><span class="o">.</span><span class="n">get_color_u32_rgba</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw all navigation bar buttons.&quot;&quot;&quot;</span>
        <span class="n">viz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz</span>

        <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_position</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">viz</span><span class="o">.</span><span class="n">menu_bar_height</span><span class="p">)</span>
        <span class="n">buttonbar_height</span> <span class="o">=</span> <span class="n">viz</span><span class="o">.</span><span class="n">content_height</span> <span class="o">-</span> <span class="n">viz</span><span class="o">.</span><span class="n">menu_bar_height</span> <span class="o">-</span> <span class="n">viz</span><span class="o">.</span><span class="n">status_bar_height</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buttonbar_width</span><span class="p">,</span> <span class="n">buttonbar_height</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span>
            <span class="s1">&#39;Sidebar&#39;</span><span class="p">,</span>
            <span class="n">closable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_TITLE_BAR</span> <span class="o">|</span> <span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_RESIZE</span> <span class="o">|</span> <span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_MOVE</span> <span class="o">|</span> <span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_BRING_TO_FRONT_ON_FOCUS</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">b_id</span><span class="p">,</span> <span class="n">b_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">navbuttons</span><span class="p">):</span>
            <span class="n">start_px</span> <span class="o">=</span> <span class="n">b_id</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">navbutton_width</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_navbar_button</span><span class="p">(</span><span class="n">b_name</span><span class="p">,</span> <span class="n">start_px</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_navbar_button</span><span class="p">(</span><span class="s1">&#39;circle_lightning&#39;</span><span class="p">,</span> <span class="n">buttonbar_height</span> <span class="o">+</span> <span class="n">viz</span><span class="o">.</span><span class="n">menu_bar_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">navbutton_width</span><span class="o">*</span><span class="mi">3</span> <span class="o">-</span> <span class="n">viz</span><span class="o">.</span><span class="n">status_bar_height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_navbar_button</span><span class="p">(</span><span class="s1">&#39;extensions&#39;</span><span class="p">,</span> <span class="n">buttonbar_height</span> <span class="o">+</span> <span class="n">viz</span><span class="o">.</span><span class="n">menu_bar_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">navbutton_width</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="n">viz</span><span class="o">.</span><span class="n">status_bar_height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_navbar_button</span><span class="p">(</span><span class="s1">&#39;gear&#39;</span><span class="p">,</span> <span class="n">buttonbar_height</span> <span class="o">+</span> <span class="n">viz</span><span class="o">.</span><span class="n">menu_bar_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">navbutton_width</span> <span class="o">-</span> <span class="n">viz</span><span class="o">.</span><span class="n">status_bar_height</span><span class="p">)</span>

        <span class="c1"># Draw border along the right of the buttons</span>
        <span class="c1">#draw_list = imgui.get_window_draw_list()</span>
        <span class="c1">#draw_list.add_line(self.navbutton_width-1, viz.menu_bar_height, self.navbutton_width-1, buttonbar_height+viz.menu_bar_height+5, imgui.get_color_u32_rgba(*self.viz.theme.item_hover), 1)</span>

        <span class="n">imgui</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>

    <span class="c1"># --- Public methods ------------------------------------------------------</span>

<div class="viewcode-block" id="Sidebar.add_widgets"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Sidebar.add_widgets">[docs]</a>    <span class="k">def</span> <span class="nf">add_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widgets</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add widget extension(s).</span>

<span class="sd">        Add widgets to the navigation sidebar. The ``.tag`` property is used</span>
<span class="sd">        as a unique identifier for the widget. The ``.icon`` property should</span>
<span class="sd">        be a path to an image file used for rendering the sidebar navigation</span>
<span class="sd">        icon. ``.icon_highlighted`` property should be a path to an image file</span>
<span class="sd">        used for rendering a hovered navigation icon.</span>

<span class="sd">        The widget should implement ``__call__()`` and ``.close()`` methods</span>
<span class="sd">        for rendering the imgui GUI and cleanup, respectively.</span>

<span class="sd">        Args:</span>
<span class="sd">            widgets (list(:class:`slideflow.studio.widgets.Widget`)): List of</span>
<span class="sd">                widgets to add as extensions. These should be classes, not</span>
<span class="sd">                instantiated objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widgets</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">widgets</span> <span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">widgets</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">widgets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">navbuttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">[</span><span class="n">widget</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">gl_utils</span><span class="o">.</span><span class="n">Texture</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">icon</span><span class="p">),</span> <span class="n">bilinear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mipmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">widget</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1">_highlighted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gl_utils</span><span class="o">.</span><span class="n">Texture</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">icon_highlighted</span><span class="p">),</span> <span class="n">bilinear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mipmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sidebar.remove_widget"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Sidebar.remove_widget">[docs]</a>    <span class="k">def</span> <span class="nf">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a widget from Studio.</span>

<span class="sd">        Args:</span>
<span class="sd">            widget (:class:`slideflow.studio.widgets.Widget`): Widget to remove.</span>
<span class="sd">                This should be a class, not an instantiated object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">navbuttons</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No matching widget with tag &quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;.&#39;</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">navbuttons</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">navbuttons</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>

<div class="viewcode-block" id="Sidebar.full_button"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Sidebar.full_button">[docs]</a>    <span class="k">def</span> <span class="nf">full_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render a button that spans the full width of the sidebar.</span>

<span class="sd">        The color of the button is determined through the loaded theme,</span>
<span class="sd">        ``bright_button`` properties.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): Text of the button.</span>
<span class="sd">            width (int, optional): Width of the button. If not specified,</span>
<span class="sd">                uses a width that spans the width of the sidebar.</span>

<span class="sd">        Keyword args:</span>
<span class="sd">            enabled (bool): Whether the button is enabled.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the button was clicked.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theme</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">bright_button</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON_HOVERED</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">bright_button_hovered</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON_ACTIVE</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">bright_button_active</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BORDER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_TEXT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">content_width</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">spacing</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">imgui_utils</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mf">1.7</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">pop_style_color</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Sidebar.full_button2"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Sidebar.full_button2">[docs]</a>    <span class="k">def</span> <span class="nf">full_button2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render a button that spans the full width of the sidebar.</span>

<span class="sd">        The color of the button is determined through the loaded theme,</span>
<span class="sd">        ``bright_button2`` properties.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): Text of the button.</span>
<span class="sd">            width (int, optional): Width of the button. If not specified,</span>
<span class="sd">                uses a width that spans the width of the sidebar.</span>

<span class="sd">        Keyword args:</span>
<span class="sd">            enabled (bool): Whether the button is enabled.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the button was clicked.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theme</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">bright_button2</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON_HOVERED</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">bright_button2_hovered</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON_ACTIVE</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">bright_button2_active</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_TEXT</span><span class="p">,</span> <span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">bright_button2_text</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BORDER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">content_width</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">spacing</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">imgui_utils</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mf">1.7</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">pop_style_color</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Sidebar.small_button"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Sidebar.small_button">[docs]</a>    <span class="k">def</span> <span class="nf">small_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render a small button for the sidebar.</span>

<span class="sd">        Args:</span>
<span class="sd">            image_name (str): Name of the image to render on the button.</span>
<span class="sd">                Valid names include &#39;vips&#39;, &#39;cucim&#39;, &#39;lowmem&#39;, &#39;ellipsis&#39;,</span>
<span class="sd">                &#39;gear&#39;, and &#39;refresh&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: If the button was clicked.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">viz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;small_</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gl_id</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON_HOVERED</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">button_hovered</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">push_style_color</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">COLOR_BUTTON_ACTIVE</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">button_active</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">imgui</span><span class="o">.</span><span class="n">image_button</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">viz</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span> <span class="n">viz</span><span class="o">.</span><span class="n">font_size</span><span class="p">)</span>
        <span class="n">imgui</span><span class="o">.</span><span class="n">pop_style_color</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Sidebar.large_image_button"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Sidebar.large_image_button">[docs]</a>    <span class="k">def</span> <span class="nf">large_image_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render a small button for the sidebar.</span>

<span class="sd">        Args:</span>
<span class="sd">            image_name (str): Name of the image to render on the button.</span>
<span class="sd">                Valid names include &#39;gear&#39;, &#39;circle_lightning&#39;, &#39;circle_plus&#39;,</span>
<span class="sd">                &#39;pencil&#39;, &#39;folder&#39;, &#39;floppy&#39;, &#39;model_loaded&#39;, &#39;extensions&#39;,</span>
<span class="sd">                &#39;project&#39;, &#39;slide&#39;, &#39;model&#39;, and &#39;heatmap&#39;.</span>
<span class="sd">            size (int): Simage button. Defaults to 64.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: If the button was clicked.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagebutton_width</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button_tex</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gl_id</span>
        <span class="k">return</span> <span class="n">imgui</span><span class="o">.</span><span class="n">image_button</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sidebar.draw"><a class="viewcode-back" href="../../../studio_module/#slideflow.studio.Sidebar.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the sidebar and render all widgets.&quot;&quot;&quot;</span>
        <span class="n">viz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_sidebar_button_style</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_sidebar_button_style</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_sidebar_style</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expanded</span><span class="p">:</span>
            <span class="n">drawing_control_pane</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">viz</span><span class="o">.</span><span class="n">pane_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_width</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">navbutton_width</span><span class="p">,</span> <span class="n">viz</span><span class="o">.</span><span class="n">menu_bar_height</span><span class="p">)</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">set_next_window_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content_width</span><span class="p">,</span> <span class="n">viz</span><span class="o">.</span><span class="n">content_height</span> <span class="o">-</span> <span class="n">viz</span><span class="o">.</span><span class="n">menu_bar_height</span> <span class="o">-</span> <span class="n">viz</span><span class="o">.</span><span class="n">status_bar_height</span><span class="p">)</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span>
                <span class="s1">&#39;Control Pane&#39;</span><span class="p">,</span>
                <span class="n">closable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">flags</span><span class="o">=</span><span class="p">(</span><span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_TITLE_BAR</span> <span class="o">|</span> <span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_RESIZE</span> <span class="o">|</span> <span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_MOVE</span> <span class="o">|</span> <span class="n">imgui</span><span class="o">.</span><span class="n">WINDOW_NO_BRING_TO_FRONT_ON_FOCUS</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">viz</span><span class="o">.</span><span class="n">pane_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">navbutton_width</span>
            <span class="n">drawing_control_pane</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># --- Core widgets (always rendered, not always shown) ----------------</span>

        <span class="c1"># Slide widget</span>
        <span class="n">viz</span><span class="o">.</span><span class="n">slide_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expanded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">==</span> <span class="s1">&#39;slide&#39;</span><span class="p">)</span>

        <span class="c1"># Project widget</span>
        <span class="n">viz</span><span class="o">.</span><span class="n">project_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expanded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">==</span> <span class="s1">&#39;project&#39;</span><span class="p">)</span>

        <span class="c1"># Model widget</span>
        <span class="n">viz</span><span class="o">.</span><span class="n">model_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expanded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span><span class="p">)</span>

        <span class="c1"># Heatmap / prediction widget</span>
        <span class="n">viz</span><span class="o">.</span><span class="n">heatmap_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expanded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">==</span> <span class="s1">&#39;heatmap&#39;</span><span class="p">)</span>

        <span class="c1"># Performance / capture widget</span>
        <span class="n">viz</span><span class="o">.</span><span class="n">performance_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expanded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">==</span> <span class="s1">&#39;circle_lightning&#39;</span><span class="p">)</span>
        <span class="n">viz</span><span class="o">.</span><span class="n">capture_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expanded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">==</span> <span class="s1">&#39;circle_lightning&#39;</span><span class="p">)</span>

        <span class="c1"># Extensions widget</span>
        <span class="n">viz</span><span class="o">.</span><span class="n">extensions_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expanded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">==</span> <span class="s1">&#39;extensions&#39;</span><span class="p">)</span>

        <span class="c1"># Settings widget</span>
        <span class="n">viz</span><span class="o">.</span><span class="n">settings_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expanded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">==</span> <span class="s1">&#39;gear&#39;</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>

        <span class="c1"># User-defined widgets</span>
        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">viz</span><span class="o">.</span><span class="n">widgets</span><span class="p">:</span>
            <span class="n">widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expanded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">==</span> <span class="n">widget</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>

        <span class="c1"># Render control panel contents, if the control pane is shown.</span>
        <span class="k">if</span> <span class="n">drawing_control_pane</span><span class="p">:</span>
            <span class="n">imgui</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_end_sidebar_style</span><span class="p">()</span></div></div>

<span class="c1"># -----------------------------------------------------------------------------</span>
</pre></div>

             </article>

            </div>
            <footer>




    <hr>



  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, James M Dolezal.

    </p>
  </div>

      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>


</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">

            </div>
          </div>
        </div>
      </section>
    </div>







       <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
         <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
         <script src="../../../_static/doctools.js"></script>
         <script src="../../../_static/sphinx_highlight.js"></script>



  <script type="text/javascript" src="../../../_static/js/vendor/jquery-3.6.3.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  <!-- Begin Footer -->

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://slideflow.dev">Docs</a>
          </li>

          <li>
            <a href="https://slideflow.dev/tutorial1/">Tutorials</a>
          </li>

          <li>
            <a href="https://github.com/slideflow/slideflow">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script script type="text/javascript">
    var collapsedSections = [];
  </script>

  <script type="text/javascript" src="../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>